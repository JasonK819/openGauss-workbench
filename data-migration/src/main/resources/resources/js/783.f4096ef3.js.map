{"version":3,"file":"js/783.f4096ef3.js","mappings":"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","sources":["webpack://web-ui/./src/api/list.js","webpack://web-ui/./node_modules/vue-loader/dist/exportHelper.js","webpack://web-ui/./src/views/list/index.vue","webpack://web-ui/./src/views/list/index.vue?9933"],"sourcesContent":["import axios from 'axios'\n\nexport function list (query) {\n  return axios.get('/plugins/data-migration/migration/list', { params: query })\n}\n\nexport function start (id) {\n  return axios.post(`/plugins/data-migration/migration/start/${id}`)\n}\n\nexport function stop (id) {\n  return axios.post(`/plugins/data-migration/migration/finish/${id}`)\n}\n\nexport function deleteTask (ids) {\n  return axios.delete(`/plugins/data-migration/migration/${ids}`)\n}\n\nexport function userList () {\n  return axios.get('/plugins/data-migration/migration/list/createUsers')\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","<template>\n  <div class=\"list-container\">\n    <div class=\"search-con\">\n      <a-form :model=\"form\" layout=\"inline\">\n        <a-form-item field=\"taskName\" style=\"margin-left: -17px;\">\n          <a-input v-model=\"form.taskName\" allow-clear placeholder=\"请输入任务名称\" style=\"width: 200px;\" @change=\"getList\"></a-input>\n        </a-form-item>\n        <a-form-item field=\"createUser\" style=\"margin-left: -17px;\">\n          <a-select v-model=\"form.createUser\" placeholder=\"请选择用户\" allow-clear style=\"width: 150px;\" @change=\"getList\">\n            <a-option v-for=\"item in userData\" :key=\"item\" :value=\"item\">{{ item }}</a-option>\n          </a-select>\n        </a-form-item>\n        <a-form-item field=\"execStatus\" style=\"margin-left: -17px;\">\n          <a-select v-model=\"form.execStatus\" placeholder=\"请选择状态\" allow-clear style=\"width: 150px;\" @change=\"getList\">\n            <a-option :value=\"0\">未启动</a-option>\n            <a-option :value=\"1\">迁移中</a-option>\n            <a-option :value=\"2\">已完成</a-option>\n          </a-select>\n        </a-form-item>\n        <a-form-item field=\"execStartTime\" style=\"margin-left: -17px;\">\n          <a-date-picker v-model=\"form.execStartTime\" placeholder=\"请选择执行时间\" style=\"width: 150px;\" @change=\"getList\" />\n        </a-form-item>\n        <a-form-item field=\"finishEndTime\" style=\"margin-left: -17px;\">\n          <a-date-picker v-model=\"form.finishEndTime\" placeholder=\"请选择完成时间\" style=\"width: 150px;\" @change=\"getList\" />\n        </a-form-item>\n        <a-form-item>\n          <a-button type=\"outline\" @click=\"getList\">\n            <template #icon>\n              <icon-search />\n            </template>\n            <template #default>查询</template>\n          </a-button>\n          <a-button style=\"margin-left: 10px;\" @click=\"resetQuery\">\n            <template #icon>\n              <icon-sync />\n            </template>\n            <template #default>重置</template>\n          </a-button>\n        </a-form-item>\n      </a-form>\n    </div>\n    <div class=\"btn-con\">\n      <a-space>\n        <a-button type=\"primary\" @click=\"createTask\">\n          <template #icon>\n            <icon-plus />\n          </template>\n          <template #default>创建数据迁移任务</template>\n        </a-button>\n        <a-button status=\"success\" @click=\"getList\">\n          <template #icon>\n            <icon-sync />\n          </template>\n          <template #default>刷新</template>\n        </a-button>\n        <a-button status=\"warning\" @click=\"deleteMore\">\n          <template #icon>\n            <icon-delete />\n          </template>\n          <template #default>批量删除</template>\n        </a-button>\n      </a-space>\n    </div>\n    <div class=\"table-con\">\n      <a-table :loading=\"loading\" row-key=\"id\" :data=\"tableData\" :row-selection=\"rowSelection\" v-model:selectedKeys=\"selectedKeys\" :bordered=\"false\" stripe :pagination=\"pagination\" @page-change=\"pageChange\">\n        <template #columns>\n          <a-table-column title=\"任务名称\" data-index=\"taskName\" :width=\"150\" fixed=\"left\"></a-table-column>\n          <a-table-column title=\"创建人\" data-index=\"createUser\" :width=\"100\"></a-table-column>\n          <a-table-column title=\"执行状态\" data-index=\"execStatus\" :width=\"120\">\n            <template #cell=\"{ record }\">\n              {{ execStatusMap(record.execStatus) }}\n            </template>\n          </a-table-column>\n          <a-table-column title=\"进度\" data-index=\"execProgress\" :width=\"150\">\n            <template #cell=\"{ record }\">\n              <a-progress :percent=\"record.execStatus === 2 ? 1 : (record.execProgress || 0)\" />\n            </template>\n          </a-table-column>\n          <a-table-column title=\"已执行时长\" :width=\"150\">\n            <template #cell=\"{ record }\">\n              {{ calcTime(record) }}\n            </template>\n          </a-table-column>\n          <a-table-column title=\"任务创建时间\" data-index=\"createTime\" :width=\"200\"></a-table-column>\n          <a-table-column title=\"执行开始时间\" data-index=\"execTime\" :width=\"200\"></a-table-column>\n          <a-table-column title=\"任务完成时间\" data-index=\"finishTime\" :width=\"200\"></a-table-column>\n          <a-table-column title=\"操作\" align=\"center\" :width=\"240\" fixed=\"right\">\n            <template #cell=\"{ record }\">\n              <a-button\n                size=\"mini\"\n                type=\"text\"\n                @click=\"goDetail(record)\"\n              >\n                <template #icon>\n                  <icon-edit />\n                </template>\n                <template #default>详情</template>\n              </a-button>\n              <a-button\n                v-if=\"record.execStatus === 1\"\n                size=\"mini\"\n                type=\"text\"\n                @click=\"stopTask(record)\"\n              >\n                <template #icon>\n                  <icon-pause />\n                </template>\n                <template #default>结束迁移</template>\n              </a-button>\n              <a-button\n                v-if=\"record.execStatus === 0\"\n                :loading=\"startLoading\"\n                size=\"mini\"\n                type=\"text\"\n                @click=\"startTask(record)\"\n              >\n                <template #icon>\n                  <icon-play-arrow />\n                </template>\n                <template #default>启动</template>\n              </a-button>\n              <a-popconfirm v-if=\"record.execStatus === 0\" content=\"你确认删除此任务吗？\" @ok=\"deleteTheTask(record)\">\n                <a-button\n                  size=\"mini\"\n                  type=\"text\"\n                >\n                  <template #icon>\n                    <icon-delete />\n                  </template>\n                  <template #default>删除</template>\n                </a-button>\n              </a-popconfirm>\n            </template>\n          </a-table-column>\n        </template>\n      </a-table>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { reactive, ref, onMounted } from 'vue'\nimport { Message } from '@arco-design/web-vue'\nimport { list, start, stop, deleteTask, userList } from '@/api/list'\nimport dayjs from 'dayjs'\n\nconst loading = ref(true)\nconst startLoading = ref(false)\n\nconst form = reactive({\n  taskName: undefined,\n  createUser: undefined,\n  execStatus: undefined,\n  execStartTime: undefined,\n  finishEndTime: undefined\n})\n\nconst userData = ref([])\n\nconst queryParams = reactive({\n  pageNum: 1,\n  pageSize: 10\n})\n\nconst pagination = reactive({\n  total: 0,\n  current: 1,\n  pageSize: 10\n})\n\nconst tableData = ref([])\nconst selectedKeys = ref([])\nconst rowSelection = reactive({\n  type: 'checkbox',\n  showCheckedAll: true,\n  onlyCurrent: false\n})\n\n// status map\nconst execStatusMap = (status) => {\n  const maps = {\n    0: '未启动',\n    1: '迁移中',\n    2: '已完成'\n  }\n  return maps[status]\n}\n\n// get task list data\nconst getList = () => {\n  loading.value = true\n  list({\n    taskName: form.taskName,\n    createUser: form.createUser,\n    execStatus: form.execStatus,\n    execStartTime: form.execStartTime,\n    finishEndTime: form.finishEndTime,\n    ...queryParams\n  }).then(res => {\n    loading.value = false\n    tableData.value = res.rows.map(item => ({ ...item, disabled: item.execStatus !== 0 }))\n    pagination.total = res.total\n  }).catch(() => {\n    loading.value = false\n  })\n}\n\nconst resetQuery = () => {\n  form.taskName = undefined\n  form.createUser = undefined\n  form.execStatus = undefined\n  form.execStartTime = undefined\n  form.finishEndTime = undefined\n  getList()\n}\n\nconst pageChange = current => {\n  queryParams.pageNum = current\n  pagination.current = current\n  getList()\n}\n\nconst calcTime = row => {\n  if (row.execStatus === 1 || row.execStatus === 2) {\n    const seconds = row.finishTime ? dayjs(row.finishTime).diff(dayjs(row.execTime), 'seconds') : dayjs().diff(dayjs(row.execTime), 'seconds')\n    const hour = parseInt(seconds / 3600)\n    const minute = parseInt((seconds - hour * 3600) / 60)\n    return `${hour ? hour + '小时' : ''} ${minute ? minute + '分钟' : ''}`\n  } else {\n    return ''\n  }\n}\n\n// jump to the page of task-config\nconst createTask = () => {\n  window.$wujie?.props.methods.jump({\n    name: `Static-pluginData-migrationTaskConfig`\n  })\n}\n\n// start task\nconst startTask = async row => {\n  try {\n    startLoading.value = true\n    await start(row.id)\n    Message.success('Start success')\n    startLoading.value = false\n  } catch (e) {\n    startLoading.value = false\n  }\n  getList()\n}\n\n// stop task\nconst stopTask = async row => {\n  await stop(row.id)\n  Message.success('Stop success')\n  getList()\n}\n\n// remove a task\nconst deleteTheTask = async row => {\n  await deleteTask(row.id)\n  Message.success('Delete success')\n  getList()\n}\n\n// remove more tasks\nconst deleteMore = async () => {\n  if (!selectedKeys.value.length) {\n    Message.error('Please select at least one piece of data')\n    return\n  }\n  await deleteTask(selectedKeys.value.join(','))\n  Message.success('Delete success')\n}\n\n// get user data\nconst getUserList = () => {\n  userList().then(res => {\n    userData.value = res.data\n  })\n}\n\n// jump to the page of task-detail\nconst goDetail = row => {\n  if (row.execStatus === 0) {\n    window.$wujie?.props.methods.jump({\n      name: `Static-pluginData-migrationTaskConfig`,\n      query: {\n        id: row.id\n      }\n    })\n  } else {\n    window.$wujie?.props.methods.jump({\n      name: `Static-pluginData-migrationTaskDetail`,\n      query: {\n        id: row.id\n      }\n    })\n  }\n}\n\nonMounted(() => {\n  getList()\n  getUserList()\n  window.$wujie?.bus.$on('data-migration-update', () => {\n    getList()\n  })\n})\n</script>\n\n<style lang=\"less\" scoped>\n.list-container {\n  position: relative;\n  .search-con {\n    padding: 16px 20px 10px;\n    display: flex;\n    justify-content: space-between;\n  }\n  .btn-con {\n    padding: 0 20px;\n  }\n  .table-con {\n    margin-top: 20px;\n    padding: 0 20px 30px;\n  }\n}\n</style>\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=4eb552ae&lang=less&scoped=true\"\n\nimport exportComponent from \"/Users/xielibo/ideawork/huawei/openGauss-workbench/data-migration/web-ui/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4eb552ae\"]])\n\nexport default __exports__"],"names":["list","query","axios","params","start","id","stop","deleteTask","ids","userList","exports","sfc","props","target","__vccOpts","key","val","loading","startLoading","form","taskName","undefined","createUser","execStatus","execStartTime","finishEndTime","userData","queryParams","pageNum","pageSize","pagination","total","current","tableData","selectedKeys","rowSelection","type","showCheckedAll","onlyCurrent","execStatusMap","status","maps","getList","value","then","res","rows","map","item","disabled","catch","resetQuery","pageChange","calcTime","row","seconds","finishTime","diff","execTime","hour","parseInt","minute","createTask","window","$wujie","methods","jump","name","startTask","async","e","stopTask","deleteTheTask","deleteMore","length","join","getUserList","data","goDetail","bus","$on","__exports__"],"sourceRoot":""}