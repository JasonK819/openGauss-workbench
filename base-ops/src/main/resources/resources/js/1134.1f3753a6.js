"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[1134],{39518:function(e,t,a){a.d(t,{$4:function(){return k},Ac:function(){return u},BL:function(){return h},C4:function(){return D},DF:function(){return N},GD:function(){return $},IW:function(){return M},K4:function(){return T},Kf:function(){return E},LR:function(){return n},Lf:function(){return o},Ox:function(){return B},PK:function(){return d},R1:function(){return q},Sv:function(){return _},T2:function(){return f},T4:function(){return S},TL:function(){return v},TY:function(){return j},Uw:function(){return x},We:function(){return R},YQ:function(){return P},Ye:function(){return g},ZA:function(){return F},_V:function(){return c},c0:function(){return s},gi:function(){return U},h:function(){return w},jQ:function(){return O},jV:function(){return A},nT:function(){return C},sT:function(){return I},tA:function(){return i},ur:function(){return b},w3:function(){return p},xj:function(){return m},y6:function(){return L},zs:function(){return y},zx:function(){return V}});var l=a(9669),r=a.n(l);const o=()=>r().get("encryption/getKey"),n=e=>r().post("opsCluster/download",e||{}),s=e=>r().get(`opsCluster/env/${e}`),u=e=>r().post("opsCluster/install",e),i=e=>r().post("opsCluster/import",e),d=e=>r().post("opsCluster/quickInstall",e),m=e=>r().get("opsCluster/check",{params:e}),p=e=>r().post("opsCluster/uninstall",e),f=e=>r().get("opsCluster/hasName",{params:e}),c=()=>r().get("opsCluster/listCluster"),g=e=>r().post("opsCluster/ssh",e),C=e=>r().get("opsCluster/monitor",{params:e}),h=e=>r().post("opsCluster/start",e),I=e=>r().post("opsCluster/stop",e),b=e=>r().post("opsCluster/restart",e),v=e=>r().get("opsCluster/listHost",{params:e}),w=e=>r().get(e?`opsCluster/listInstallPackage?path=${e}`:"opsCluster/listInstallPackage"),V=()=>r().get("host/listAll"),P=e=>r().get(`hostUser/listAllWithoutRoot/${e}`),k=()=>r().get("az/listAll"),N=e=>r().get("opsCluster/logPath",{params:e}),U=e=>r().get("opsCluster/ls",{params:e}),x=e=>r().get("opsCluster/slowSql",{params:e}),$=e=>r().get("opsCluster/auditLog",{params:e}),_=e=>r().get("opsCluster/download",{params:e}),L=e=>r().get("wdr/list",{params:e}),q=e=>r().post("wdr/generate",e),y=e=>r()["delete"]("wdr/del/"+e),B=e=>r().get("wdr/createSnapshot",{params:e}),T=e=>r().get("wdr/downloadWdr",{params:e}),D=e=>r().get("wdr/listSnapshot",{params:e}),M=e=>r().post("backup/backup",e),S=e=>r().get("backup/page",{params:e}),E=(e,t)=>r().post("backup/recover/"+e,t),A=e=>r()["delete"]("backup/del/"+e),R=e=>r().get("installPackageManager/page",{params:e}),j=e=>r()["delete"]("installPackageManager/"+e),F=e=>r().post("installPackageManager/save",e),O=(e,t)=>r().put(`installPackageManager/update/${e}`,t)},83744:function(e,t){t.Z=(e,t)=>{const a=e.__vccOpts||e;for(const[l,r]of t)a[l]=r;return a}},21134:function(e,t,a){a.r(t),a.d(t,{default:function(){return C}});var l=a(70821),r=a(98535),o=a(40225),n=a(39518),s=a(15784),u=a(57330);const i={class:"install-config-c"},d={class:"flex-row-center"},m={class:"flex-col-start"},p={class:"ft-b mb"};var f=(0,l.defineComponent)({setup(e,{expose:t}){const{t:a}=(0,u.QT)(),f=(0,o.BH)(),c=(0,l.reactive)({form:{clusterId:"",hostId:"",rootPassword:"",privateIp:"",publicIp:"",installUserId:"",installPath:"/opt/openGauss",dataPath:"/opt/openGauss/data",port:Number(5432),databaseUsername:"",databasePassword:"",isInstallDemoDatabase:!0},rules:{}}),g=(0,l.ref)(!1),C=(0,l.ref)([]);(0,l.onMounted)((()=>{if(h(),f.getMiniConfig&&f.getMiniConfig.nodeConfigList){const e=f.getMiniConfig;Object.assign(c.form,{clusterId:e.nodeConfigList[0].clusterId,hostId:e.nodeConfigList[0].hostId,rootPassword:e.nodeConfigList[0].rootPassword,privateIp:e.nodeConfigList[0].privateIp,publicIp:e.nodeConfigList[0].publicIp,installUserId:e.nodeConfigList[0].installUserId,installPath:e.nodeConfigList[0].installPath,dataPath:e.nodeConfigList[0].dataPath,port:e.port,databaseUsername:e.databaseUsername,databasePassword:e.databasePassword,isInstallDemoDatabase:e.nodeConfigList[0].isInstallDemoDatabase})}b()}));const h=()=>{c.rules={clusterId:[{required:!0,"validate-trigger":"blur",message:a("simple.InstallConfig.5mpmu0laqiw0")},{validator:(e,t)=>new Promise((l=>{const r={name:e};(0,n.T2)(r).then((e=>{200===Number(e.code)?"Y"===e.data.has?(t(a("simple.InstallConfig.5mpmu0las4g0")),l(!1)):l(!0):(t(a("simple.InstallConfig.5mpmu0las800")),l(!1))}))}))}],port:[{required:!0,"validate-trigger":"blur",message:a("simple.InstallConfig.5mpmu0larmo0")}],rootPassword:[{required:!0,"validate-trigger":"blur",message:a("simple.InstallConfig.5mpmu0laqwo0")}],installPath:[{required:!0,"validate-trigger":"blur",message:a("simple.InstallConfig.5mpmu0lar800")}],dataPath:[{required:!0,"validate-trigger":"blur",message:a("simple.InstallConfig.5mpmu0larew0")}],databaseUsername:[{required:!0,"validate-trigger":"blur",message:a("simple.InstallConfig.5mpmu0larto0")}],databasePassword:[{required:!0,"validate-trigger":"blur",message:a("simple.InstallConfig.5mpmu0las0k0")}]}},I=(0,l.ref)({}),b=()=>{g.value=!0,(0,n.zx)().then((e=>{200===Number(e.code)?(C.value=[],C.value=e.data,e.data.forEach((e=>{I.value[e.hostId]=e})),c.form.hostId||(c.form.hostId=C.value[0].hostId,c.form.privateIp=C.value[0].privateIp,c.form.publicIp=C.value[0].publicIp),w()):s.Z.error("Failed to obtain the host list data")})).finally((()=>{g.value=!1}))},v=(0,l.ref)([]),w=()=>{c.form.hostId&&(I.value[c.form.hostId]&&(c.form.privateIp=I.value[c.form.hostId].privateIp,c.form.publicIp=I.value[c.form.hostId].publicIp),(0,n.YQ)(c.form.hostId).then((e=>{200===Number(e.code)?(v.value=[],v.value=e.data,v.value.length?c.form.installUserId=v.value[0].hostUserId:c.form.installUserId=""):s.Z.error("Failed to obtain user data from the host")})))},V=(0,l.ref)(),P=async()=>{const e=await(V.value?.validate());if(e)return!1;{const e=JSON.parse(JSON.stringify(c.form));e.clusterRole=r._.MASTER,e.clusterName="",f.setInstallContext({clusterId:e.clusterId});const t={clusterName:"",port:e.port,databaseUsername:e.databaseUsername,databasePassword:e.databasePassword,nodeConfigList:[e]};return f.setMiniConfig(t),!0}},k=(0,l.computed)((()=>f.getInstallConfig.installType));return t({beforeConfirm:P}),(e,t)=>{const a=(0,l.resolveComponent)("a-input"),r=(0,l.resolveComponent)("a-form-item"),o=(0,l.resolveComponent)("a-option"),n=(0,l.resolveComponent)("a-select"),s=(0,l.resolveComponent)("a-input-password"),u=(0,l.resolveComponent)("a-input-number"),f=(0,l.resolveComponent)("a-form");return(0,l.openBlock)(),(0,l.createElementBlock)("div",i,[(0,l.createElementVNode)("div",d,[(0,l.createElementVNode)("div",m,[(0,l.createElementVNode)("div",p,(0,l.toDisplayString)(e.$t("simple.InstallConfig.5mpmu0lapic0")),1),(0,l.createVNode)(f,{model:(0,l.unref)(c).form,rules:(0,l.unref)(c).rules,style:{width:"800px"},ref:(e,t)=>{t["formRef"]=e,V.value=e}},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(r,{field:"clusterId",label:e.$t("simple.InstallConfig.5mpmu0laqc80"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(a,{modelValue:(0,l.unref)(c).form.clusterId,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,l.unref)(c).form.clusterId=e),placeholder:e.$t("simple.InstallConfig.5mpmu0laqiw0")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,l.createVNode)(r,{field:"hostId",label:e.$t("simple.InstallConfig.5mpmu0laqow0")},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(n,{loading:g.value,modelValue:(0,l.unref)(c).form.hostId,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,l.unref)(c).form.hostId=e),onChange:w,placeholder:e.$t("simple.InstallConfig.5mpmu0laqss0")},{default:(0,l.withCtx)((()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(C.value,(e=>((0,l.openBlock)(),(0,l.createBlock)(o,{key:e.hostId,value:e.hostId},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.publicIp+"("+(e.hostname?e.hostname:"--")+")"),1)])),_:2},1032,["value"])))),128))])),_:1},8,["loading","modelValue","placeholder"])])),_:1},8,["label"]),(0,l.createVNode)(r,{field:"rootPassword",label:e.$t("simple.InstallConfig.else1"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(s,{modelValue:(0,l.unref)(c).form.rootPassword,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,l.unref)(c).form.rootPassword=e),placeholder:e.$t("simple.InstallConfig.5mpmu0laqwo0"),"allow-clear":""},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,l.createVNode)(r,{field:"installUserId",label:e.$t("simple.InstallConfig.5mpmu0lar0c0")},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(n,{modelValue:(0,l.unref)(c).form.installUserId,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,l.unref)(c).form.installUserId=e)},{default:(0,l.withCtx)((()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(v.value,(e=>((0,l.openBlock)(),(0,l.createBlock)(o,{key:e.hostUserId,value:e.hostUserId},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),(0,l.createVNode)(r,{field:"installPath",label:e.$t("simple.InstallConfig.5mpmu0lar480"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(a,{modelValue:(0,l.unref)(c).form.installPath,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,l.unref)(c).form.installPath=e),placeholder:e.$t("simple.InstallConfig.5mpmu0lar800")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,l.createVNode)(r,{field:"dataPath",label:e.$t("simple.InstallConfig.5mpmu0larbk0"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(a,{modelValue:(0,l.unref)(c).form.dataPath,"onUpdate:modelValue":t[5]||(t[5]=e=>(0,l.unref)(c).form.dataPath=e),placeholder:e.$t("simple.InstallConfig.5mpmu0larew0")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,l.createVNode)(r,{field:"port",label:e.$t("simple.InstallConfig.5mpmu0larj40"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(u,{modelValue:(0,l.unref)(c).form.port,"onUpdate:modelValue":t[6]||(t[6]=e=>(0,l.unref)(c).form.port=e),placeholder:e.$t("simple.InstallConfig.5mpmu0larmo0")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),"import"===(0,l.unref)(k)?((0,l.openBlock)(),(0,l.createBlock)(r,{key:0,field:"databaseUsername",label:e.$t("simple.InstallConfig.5mpmu0larq40"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(s,{modelValue:(0,l.unref)(c).form.databaseUsername,"onUpdate:modelValue":t[7]||(t[7]=e=>(0,l.unref)(c).form.databaseUsername=e),placeholder:e.$t("simple.InstallConfig.5mpmu0larto0"),"allow-clear":""},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):(0,l.createCommentVNode)("",!0),(0,l.createVNode)(r,{field:"databasePassword",label:e.$t("simple.InstallConfig.5mpmu0larx00"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(s,{modelValue:(0,l.unref)(c).form.databasePassword,"onUpdate:modelValue":t[8]||(t[8]=e=>(0,l.unref)(c).form.databasePassword=e),placeholder:e.$t("simple.InstallConfig.5mpmu0las0k0"),"allow-clear":""},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model","rules"])])])])}}}),c=a(83744);const g=(0,c.Z)(f,[["__scopeId","data-v-21797c30"]]);var C=g}}]);
//# sourceMappingURL=1134.1f3753a6.js.map