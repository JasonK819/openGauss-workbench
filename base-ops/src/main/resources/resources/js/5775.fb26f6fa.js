(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[5775],{33781:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});var n=o(47327);class r{constructor(){(0,n.Z)(this,"heartTimeOut",void 0),(0,n.Z)(this,"ServerHeartTimeOut",void 0),(0,n.Z)(this,"timeout",5e3)}reset(){clearTimeout(this.heartTimeOut),clearTimeout(this.ServerHeartTimeOut)}start(e){this.heartTimeOut=setTimeout((t=>{e(t),this.ServerHeartTimeOut=setTimeout((t=>{e(t),this.reset(),this.start(e)}),this.timeout)}),this.timeout)}}class s extends r{constructor(e){super(),(0,n.Z)(this,"ws",void 0),(0,n.Z)(this,"reconnectTimer",0),(0,n.Z)(this,"reconnectCount",10),(0,n.Z)(this,"options",{url:null,heartTime:5e3,heartMsg:"ping",isReconnect:!0,isRestory:!1,reconnectTime:5e3,reconnectCount:5,openCb:e=>{console.log("connect success callback::::",e)},closeCb:e=>{console.log("close callback::::",e)},messageCb:e=>{console.log("message callback::::",e)},errorCb:e=>{console.log("error callback::::",e)}}),Object.assign(this.options,e),this.create()}create(){if(!("WebSocket"in window))throw new Error("The current browser does not support it and cannot be used");if(!this.options.url)throw new Error("The address does not exist, and the channel cannot be established");let e;console.log("get locaion host: ",window.location.host),e=`ws://${window.location.host}/ws/base-ops/${this.options.url}`,this.ws=new WebSocket(e),this.onopen(this.options.openCb),this.onclose(this.options.closeCb),this.onmessage(this.options.messageCb)}onopen(e){this.ws.onopen=t=>{"function"===typeof e?e(t):"function"===typeof this.options.openCb&&this.options.openCb(t)}}onclose(e){this.ws.onclose=t=>{"function"===typeof e?e(t):"function"===typeof this.options.closeCb&&this.options.closeCb(t)}}onerror(e){this.ws.onerror=t=>{"function"===typeof e?e(t):"function"===typeof this.options.errorCb&&this.options.errorCb(t)}}onmessage(e){this.ws.onmessage=t=>{const o=t.data;"function"===typeof e&&e(o)}}send(e){console.log("doNothing",e)}destroy(){super.reset(),clearTimeout(this.reconnectTimer),this.options.isRestory=!0,this.ws.close()}}},95775:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return L}});o(57658);var n=o(70821),r=o(12320),s=o(12617),i=o(3334),l=o(39518),a=o(98535),c=o(40225),u=o(33781),d=o(79134);const p=e=>((0,n.pushScopeId)("data-v-0313266b"),e=e(),(0,n.popScopeId)(),e),m={class:"exe-install-c"},h={key:0,class:"flex-col full-w full-h"},f={class:"mb-lg"},v={class:"install-connect-c flex-col mb-xlg"},g={class:"ft-b mb"},y={class:"mb"},b=p((()=>(0,n.createElementVNode)("span",{class:"content"},"gaussdb",-1))),w={class:"content"},_={class:"flex-row"},S={key:1,class:"flex-row full-w teminal-h"},x={class:"panel-w flex-col-start mr"},C=p((()=>(0,n.createElementVNode)("div",{id:"xtermLog",class:"xterm"},null,-1))),k={key:0,class:"panel-w flex-col-start"},E={class:"full-w flex-between mb"},I=p((()=>(0,n.createElementVNode)("div",{id:"xterm",class:"xterm"},null,-1)));var N;(function(e){e[e["UN_INSTALL"]=Number(-1)]="UN_INSTALL",e[e["SUCESS"]=Number(1)]="SUCESS",e[e["FAIL"]=Number(0)]="FAIL"})(N||(N={}));var T=(0,n.defineComponent)({setup(e,{expose:t}){const o=(0,c.BH)(),p=(0,n.ref)(""),T=(0,n.ref)([]),V=(0,n.ref)({}),B=(0,n.ref)(""),L=(0,n.ref)(N.UN_INSTALL),j=(0,n.ref)(),A=(0,n.ref)(),O=(0,n.ref)(),P=(0,n.ref)(),D=(0,n.inject)("loading");(0,n.onMounted)((()=>{D.setNextBtnShow(!1),T.value=[],Object.keys(o.getLiteConfig).length&&(B.value=o.getLiteConfig.databasePassword,o.getLiteConfig.nodeConfigList.forEach((e=>{V.value[e.hostId]=e,T.value.push({hostId:e.hostId,privateIp:e.privateIp+"("+e.publicIp+")"})})),p.value=T.value[0].hostId),F()})),(0,n.onBeforeUnmount)((()=>{j.value?.destroy(),A.value?.destroy(),O.value?.dispose(),P.value?.dispose()}));const $=()=>{A.value&&A.value?.destroy(),O.value&&O.value.dispose(),F()},M=e=>{A.value&&A.value?.destroy(),P.value&&P.value.dispose(),Z()},U=()=>new r.Terminal({fontSize:14,rows:40,cols:100,cursorBlink:!0,convertEol:!0,disableStdin:!1,cursorStyle:"underline",theme:{background:"black"}}),Z=()=>{const e=U(),t=(new Date).getTime(),o=new u.Z({url:`terminal_${t}`});A.value=o,o.onopen((async()=>{const n={hostId:p.value,rootPassword:"",wsConnectType:a.Ie.SSH,businessId:`terminal_${t}`};if(console.log("show password",p.value,V),V.value[p.value]){const e=await(0,d.v)(V.value[p.value].rootPassword);n.rootPassword=e}(0,l.Ye)(n),W(e,o.ws)}))},F=()=>{const e=U(),t=(new Date).getTime(),o=new u.Z({url:`installLog_${t}`});j.value=o,o.onopen((async()=>{D.toLoading();const n=JSON.parse(JSON.stringify(J.value)),r=n.installContext.liteInstallConfig.nodeConfigList;for(let e=0;e<r.length;e++){const t=r[e],o=await(0,d.v)(t.rootPassword);t.rootPassword=o}n.businessId=`installLog_${t}`,(0,l.Ac)(n).then((t=>{200!==Number(t.code)&&(e.writeln(t.msg),o.destroy())})).catch((t=>{e.writeln(t.toString()),D.cancelLoading(),o.destroy()})),H(e,o.ws)})),o.onmessage((t=>{if(e.writeln(t),t.indexOf("FINAL_EXECUTE_EXIT_CODE")>-1){const e=Number(t.split(":")[1]);0===e?(D.setBackBtnShow(!1),D.setNextBtnShow(!1),L.value=N.SUCESS):(D.cancelLoading(),L.value=N.FAIL,P.value&&P.value.dispose(),Z()),o.destroy()}}))},H=(e,t)=>{if(t){const t=new s.FitAddon;e.loadAddon(t),e.open(document.getElementById("xtermLog")),t.fit(),e.clear(),e.focus(),O.value=e}},W=(e,t)=>{if(t){const o=new i.AttachAddon(t),n=new s.FitAddon;e.loadAddon(o),e.loadAddon(n),e.open(document.getElementById("xterm")),n.fit(),e.clear(),e.focus(),e.write("\r\n[33m$[0m "),P.value=e}},z=()=>{window.$wujie?.props.methods.jump({name:"Dashboard"})},R=async()=>!0,J=(0,n.computed)((()=>o.getInstallParam));return t({beforeConfirm:R}),(e,t)=>{const o=(0,n.resolveComponent)("svg-icon"),r=(0,n.resolveComponent)("a-button"),s=(0,n.resolveComponent)("a-alert"),i=(0,n.resolveComponent)("a-option"),l=(0,n.resolveComponent)("a-select");return(0,n.openBlock)(),(0,n.createElementBlock)("div",m,[L.value===N.SUCESS?((0,n.openBlock)(),(0,n.createElementBlock)("div",h,[(0,n.createVNode)(o,{"icon-class":"ops-install-success",class:"icon-size mb"}),(0,n.createElementVNode)("div",f,(0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1mam40")),1),(0,n.createElementVNode)("div",v,[(0,n.createElementVNode)("div",g,(0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1mbdc0")),1),(0,n.createElementVNode)("div",y,[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1mbo00"))+": ",1),b]),(0,n.createElementVNode)("div",null,[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1mbxg0"))+": ",1),(0,n.createElementVNode)("span",w,(0,n.toDisplayString)(B.value),1)])]),(0,n.createElementVNode)("div",_,[(0,n.createVNode)(r,{type:"outline",class:"mr",onClick:z},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1mc580")),1)])),_:1}),(0,n.createVNode)(r,{type:"primary",onClick:t[0]||(t[0]=t=>e.$router.push({name:"DailyOps"}))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1mce00")),1)])),_:1})])])):((0,n.openBlock)(),(0,n.createElementBlock)("div",S,[(0,n.createElementVNode)("div",x,[L.value===N.FAIL?((0,n.openBlock)(),(0,n.createBlock)(s,{key:0,class:"mb",style:{padding:"14px 12px",width:"fit-content"},type:"error"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1mcm40")),1)])),_:1})):(0,n.createCommentVNode)("",!0),L.value===N.UN_INSTALL?((0,n.openBlock)(),(0,n.createBlock)(s,{key:1,class:"mb",type:"warning",style:{padding:"14px 12px",width:"fit-content"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1mcu40"))+" "+(0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1md2o0")),1)])),_:1})):(0,n.createCommentVNode)("",!0),C]),L.value===N.FAIL?((0,n.openBlock)(),(0,n.createElementBlock)("div",k,[(0,n.createElementVNode)("div",E,[(0,n.createVNode)(l,{style:{width:"300px"},modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),onChange:M},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(T.value,((e,t)=>((0,n.openBlock)(),(0,n.createBlock)(i,{key:t,value:e.hostId,label:e.privateIp},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),(0,n.createVNode)(r,{type:"primary",onClick:$},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("lightweight.ExeInstall.5mpmjd1mdf40")),1)])),_:1})]),I])):(0,n.createCommentVNode)("",!0)]))])}}}),V=o(83744);const B=(0,V.Z)(T,[["__scopeId","data-v-0313266b"]]);var L=B},3334:function(e){!function(t,o){e.exports=o()}(window,(function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AttachAddon=void 0;var n=function(){function e(e,t){this._disposables=[],this._socket=e,this._socket.binaryType="arraybuffer",this._bidirectional=!t||!1!==t.bidirectional}return e.prototype.activate=function(e){var t=this;this._disposables.push(r(this._socket,"message",(function(t){var o=t.data;e.write("string"==typeof o?o:new Uint8Array(o))}))),this._bidirectional&&(this._disposables.push(e.onData((function(e){return t._sendData(e)}))),this._disposables.push(e.onBinary((function(e){return t._sendBinary(e)})))),this._disposables.push(r(this._socket,"close",(function(){return t.dispose()}))),this._disposables.push(r(this._socket,"error",(function(){return t.dispose()})))},e.prototype.dispose=function(){this._disposables.forEach((function(e){return e.dispose()}))},e.prototype._sendData=function(e){1===this._socket.readyState&&this._socket.send(e)},e.prototype._sendBinary=function(e){if(1===this._socket.readyState){for(var t=new Uint8Array(e.length),o=0;o<e.length;++o)t[o]=255&e.charCodeAt(o);this._socket.send(t)}},e}();function r(e,t,o){return e.addEventListener(t,o),{dispose:function(){o&&e.removeEventListener(t,o)}}}t.AttachAddon=n}])}))},12617:function(e){!function(t,o){e.exports=o()}(self,(function(){return(()=>{"use strict";var e={775:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FitAddon=void 0;var o=function(){function e(){}return e.prototype.activate=function(e){this._terminal=e},e.prototype.dispose=function(){},e.prototype.fit=function(){var e=this.proposeDimensions();if(e&&this._terminal){var t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}},e.prototype.proposeDimensions=function(){if(this._terminal&&this._terminal.element&&this._terminal.element.parentElement){var e=this._terminal._core;if(0!==e._renderService.dimensions.actualCellWidth&&0!==e._renderService.dimensions.actualCellHeight){var t=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(t.getPropertyValue("height")),n=Math.max(0,parseInt(t.getPropertyValue("width"))),r=window.getComputedStyle(this._terminal.element),s=o-(parseInt(r.getPropertyValue("padding-top"))+parseInt(r.getPropertyValue("padding-bottom"))),i=n-(parseInt(r.getPropertyValue("padding-right"))+parseInt(r.getPropertyValue("padding-left")))-e.viewport.scrollBarWidth;return{cols:Math.max(2,Math.floor(i/e._renderService.dimensions.actualCellWidth)),rows:Math.max(1,Math.floor(s/e._renderService.dimensions.actualCellHeight))}}}},e}();t.FitAddon=o}},t={};return function o(n){if(t[n])return t[n].exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}(775)})()}))},47327:function(e,t,o){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){if("object"!==n(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!==n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function s(e){var t=r(e,"string");return"symbol"===n(t)?t:String(t)}function i(e,t,o){return t=s(t),t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o.d(t,{Z:function(){return i}})}}]);
//# sourceMappingURL=5775.fb26f6fa.js.map