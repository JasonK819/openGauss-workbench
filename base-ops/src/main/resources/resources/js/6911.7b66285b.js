"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[6911,733],{89965:function(e,t,a){a.d(t,{AH:function(){return b},Bd:function(){return m},C7:function(){return _},DG:function(){return Z},Du:function(){return z},H7:function(){return U},Iz:function(){return T},J6:function(){return O},Jh:function(){return g},NQ:function(){return L},QS:function(){return F},Qt:function(){return N},R7:function(){return y},Rq:function(){return c},SB:function(){return p},SW:function(){return v},UL:function(){return f},Up:function(){return w},WK:function(){return $},Yn:function(){return I},gp:function(){return u},j9:function(){return E},nB:function(){return k},qR:function(){return B},qo:function(){return D},sZ:function(){return V},v$:function(){return s},vs:function(){return r},w0:function(){return q},wB:function(){return S},x9:function(){return K},xl:function(){return C},yA:function(){return d},yf:function(){return x}});var l=a(15784),n=a(9669),o=a.n(n),i=a(90989);const r=(e,t,a,l)=>o().get(`/modeling/dataflow/dataSourceDb/getTablesBySchema/${e}/${t}/${a}`,l||{}),d=(e,t)=>o().get(`/modeling/dataflow/dataSourceDb/getFieldsByTable/${e}`,t||{}),u=e=>o().get("/modeling/dataflow/list",{params:e}),s=e=>o().post("/modeling/dataflow/add",e||{}),c=e=>o()["delete"](`/modeling/dataflow/delete/${e}`),f=e=>o().put("/modeling/dataflow/edit",e||{}),m=e=>o().get(`/modeling/dataflow/getById/${e}`),p=(e,t)=>o().get(`/modeling/dataflow/dataSourceDb/getSchemaByClusterNodeId/${e}/${t}`,e||{}),b=e=>o().post("/modeling/dataflow/getSql",e||{}),g=e=>o().post("/modeling/dataflow/runSql",e||{});let h=!0;const w=(e,t,a)=>new Promise((n=>{h&&(h=!1,o().put("/modeling/dataflow/edit",{id:e,operatorContent:JSON.stringify(t)}).then((e=>{n(!0),h=!0,200===Number(e.code)&&(a||l.Z.success({content:i.Z.global.t("modeling.dy_common.saveSuccess")}))})).catch((()=>{n(!1),a||l.Z.error({content:i.Z.global.t("modeling.dy_common.saveFailed")}),h=!0})))})),D=e=>o().get("/modeling/dataflow/dataSourceDb/list",e||{}),$=e=>o().post("/modeling/dataflow/getResultFieldsByOperator",e||{}),v=e=>o().post("/modeling/dataflow/visualization/params/add",e||{}),x=e=>o().put("/modeling/dataflow/visualization/params/edit",e||{}),y=e=>o()["delete"](`/modeling/dataflow/visualization/params/delete/${e}`),C=e=>o().post("/modeling/dataflow/visualization/params/generateChart",e||{}),k=(e,t)=>o().get(`/modeling/dataflow/visualization/params/getListByOperatorId/${e}`,t||{}),B=e=>o().post("/modeling/dataflow/visualization/snapshot/add",e||{}),F=(e,t)=>o().get(`/modeling/dataflow/visualization/snapshot/getListByDataFlowId/${e}`,t||{}),N=e=>o()["delete"](`/modeling/dataflow/visualization/snapshot/delete/${e}`),V=(e,t)=>o().get(`/modeling/dataflow/visualization/report/getListByDataFlowId/${e}`,{params:t||{}}),S=e=>o().post("/modeling/dataflow/visualization/report/add",e||{}),_=e=>o().put("/modeling/dataflow/visualization/report/update",e||{}),T=e=>o()["delete"](`/modeling/dataflow/visualization/report/delete/${e}`),z=e=>o().get(`/modeling/dataflow/visualization/report/share/getByReportId/${e}`),I=(e,t)=>o().get(`/modeling/dataflow/visualization/customDimension/getListByOperatorId/${e}`,{params:t||{}}),O=e=>o().post("/modeling/dataflow/visualization/customDimension/add",e||{}),L=e=>o().put("/modeling/dataflow/visualization/customDimension/edit",e||{}),U=e=>o()["delete"](`/modeling/dataflow/visualization/customDimension/delete/${e}`),K=(e,t)=>o().get(`/modeling/visualization/report/share/getMapGeo/${e}`,t||{}),Z=e=>o().post("/modeling/dataflow/visualization/params/uploadGeo",e||{}),q=(e,t)=>o().get(`/modeling/dataflow/visualization/params/getGeo/${e}`,{params:t||{}}),E=e=>o()["delete"](`/modeling/dataflow/visualization/params/deleteGeo/${e}`)},8603:function(e,t,a){a.d(t,{M:function(){return r}});a(57658);var l=a(89965),n=a(95684),o=a(15784);const i={graph:null,dataFlowInfo:{},rawData:{},useData:{},useDatabase:"",useTable:[]},r=(0,n.Q_)("dataFlow",{state(){return JSON.parse(JSON.stringify(i))},getters:{getTableSelectList:e=>e.useDatabase?e.useData[e.useDatabase]:[],getFieldsSelectList:e=>{if(e.useDatabase&&e.useTable.length>0){const t=e.useData[e.useDatabase],a=[];return e.useTable.forEach((e=>{const l={group:e,fields:[]},n=t.findIndex((t=>t.tablename===e));-1!==n&&(l.fields=t[n].fields),a.push(l)})),a}return[]},getFlowDataInfo:e=>e.dataFlowInfo,getFieldsByTable:e=>t=>{if(e.useDatabase){const a=e.useData[e.useDatabase];if(0===t||"0"===t){const t=a.findIndex((t=>t.tablename===e.useTable[0]));return-1===t?[]:a[t].fields}{const e=a.findIndex((e=>e.tablename===t));return-1===e?[]:a[e].fields}}return[]},getUseTable:e=>e.useTable,getUseDatabase:e=>e.useDatabase},actions:{setGraph(e){this.$patch((t=>{t.graph=e}))},initState(){return new Promise((e=>{this.$patch((t=>{t.useData=[],t.useDatabase="",t.useTable=[],t.rawData=[],t.dataFlowInfo=[],e(!0)}))}))},clearUse(){return new Promise((e=>{this.$patch((t=>{t.useDatabase="",t.useTable=[],e(!0)}))}))},setFlowDataInfo(e){this.$patch((t=>t.dataFlowInfo=e))},setDatabaseInfo(e,t,a){return new Promise(((n,i)=>{this.$patch((r=>{r.useDatabase=`${e}|,|${t}|,|${a}`,r.useTable=[],Object.keys(r.rawData).includes(`${e}|,|${t}|,|${a}`)?n(!0):(0,l.vs)(e,t,a).then((l=>{if(200===Number(l.code)){const o=l.data.map((e=>({...e,tables:{}})));r.rawData[`${e}|,|${t}|,|${a}`]=o,r.useData[`${e}|,|${t}|,|${a}`]=o,n(!0)}else o.Z.error("database not found"),i(!0)})).catch((()=>{o.Z.error("database not found"),i(!0)}))}))}))},setDatabaseTableInfo(e,t){return new Promise((a=>{this.$patch((n=>{if(e){t&&(t.tableKey||0===t.tableKey)?n.useTable[t.tableKey]=e:t&&t.noUse||n.useTable.push(e);const o=n.rawData[n.useDatabase].findIndex((t=>t.tablename===e));Object.keys(n.rawData[n.useDatabase][o].tables).includes(e)?a(!1):(0,l.yA)(`${n.useDatabase.split("|,|").join("/")}/${e}`).then((e=>{a(!0),n.rawData[n.useDatabase][o].fields=e.data,n.useData[n.useDatabase][o].fields=e.data}))}else a(!1)}))}))},removeDatabaseTable(e){return new Promise((t=>{this.$patch((a=>{const l=a.useTable.indexOf(e);-1!==l?(a.useTable.splice(l,1),t(!0)):t(!1)}))}))}}})},733:function(e,t,a){a.r(t),a.d(t,{checkDisabled:function(){return l},saveData:function(){return n}});const l=(e,t,a)=>{if(!e||0===e.length)return!1;if("string"===typeof e[0]||"number"===typeof e[0])return-1!==e.indexOf(t);{const l=e;return-1!==l.findIndex((e=>e[a||"value"]===t))}},n=(e,t,a)=>{if(console.log(e,t,a),a){const l=a.getData();a?.setData({...l,[e]:JSON.parse(JSON.stringify(t))},{overwrite:!0})}}},63736:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var l=a(70821),n=a(29067),o=(0,l.defineComponent)({props:{content:{type:String,required:!0},text:{type:String,required:!0},otherWidth:{type:Number,required:!1},fontSize:{type:Number,required:!1}},setup(e){const t=e,a=(0,l.ref)(),o=(0,l.ref)(!1),i=()=>{let e=a.value.parentNode.offsetWidth,l=a.value.offsetWidth+(t.otherWidth||0===t.otherWidth?t.otherWidth:24);o.value=!(l>e)};return(e,r)=>((0,l.openBlock)(),(0,l.createBlock)((0,l.unref)(n.Z),{content:t.content,disabled:o.value},{default:(0,l.withCtx)((()=>[(0,l.createElementVNode)("span",{onMouseover:i},[(0,l.renderSlot)(e.$slots,"default")],32),(0,l.createElementVNode)("span",{class:"get-width",ref:(e,t)=>{t["contentRef"]=e,a.value=e}},(0,l.toDisplayString)(t.text),513)])),_:3},8,["content","disabled"]))}}),i=a(83744);const r=(0,i.Z)(o,[["__scopeId","data-v-6f1614ab"]]);var d=r},26911:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var l=a(70821),n=a(8603),o=a(733),i=a(63736);const r={class:"tab-content d-a-form"};var d=(0,l.defineComponent)({setup(e,{expose:t}){const a=(0,n.M)(),d=(0,l.computed)((()=>a.getUseTable));let u=null;const s=(0,l.reactive)({activeKey:"1"}),c=(0,l.reactive)({table:"",field:"",matchField:"",rigidField:""}),f=(0,l.computed)((()=>a.getTableSelectList)),m=(0,l.computed)((()=>a.getFieldsSelectList)),p=e=>a.getFieldsByTable(e),b=e=>{u=e;let{data:t}=u;c.table=t.table?t.table:"",c.field=t.field?t.field:"",c.matchField=t.matchField?t.matchField:"",c.rigidField=t.rigidField?t.rigidField:""},g=(e,t)=>{u&&(0,o.saveData)(e,t,u)},h=(e,t)=>{"table"===t&&(a.setDatabaseTableInfo(e,{noUse:!0}),c.matchField="",c.rigidField="",g("table",e))};return t({init:b}),(e,t)=>{const a=(0,l.resolveComponent)("a-option"),n=(0,l.resolveComponent)("a-select"),u=(0,l.resolveComponent)("a-form-item"),b=(0,l.resolveComponent)("a-optgroup"),w=(0,l.resolveComponent)("a-tab-pane"),D=(0,l.resolveComponent)("a-tabs");return(0,l.openBlock)(),(0,l.createBlock)(D,{class:"d-a-tabs",activeKey:(0,l.unref)(s).activeKey,"onUpdate:activeKey":t[8]||(t[8]=e=>(0,l.unref)(s).activeKey=e),centered:"",size:"mini",tabBarGutter:40,tabBarStyle:{color:"#fff"}},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(w,{key:"1",title:e.$t("modeling.combination.DictionaryOperator.5me6g9wp5p40")},{default:(0,l.withCtx)((()=>[(0,l.createElementVNode)("div",r,[(0,l.createVNode)(u,{label:e.$t("modeling.combination.DictionaryOperator.5me6g9wp6xk0"),labelCol:{span:6,offset:0},labelAlign:"left",colon:!1},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(n,{modelValue:(0,l.unref)(c).table,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,l.unref)(c).table=e),placeholder:e.$t("modeling.combination.DictionaryOperator.5me6g9wp74g0"),allowSearch:"",onChange:t[1]||(t[1]=e=>h(e,"table"))},{label:(0,l.withCtx)((({data:e})=>[(0,l.createVNode)(i["default"],{text:e?.label,content:e?.label,"other-width":0},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e?.label),1)])),_:2},1032,["text","content"])])),default:(0,l.withCtx)((()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(f),((e,t)=>((0,l.openBlock)(),(0,l.createBlock)(i["default"],{text:e.tablename,key:t,content:e.tablename},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(a,{value:e.tablename,disabled:(0,l.unref)(o.checkDisabled)((0,l.unref)(d),e.tablename)},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.tablename),1)])),_:2},1032,["value","disabled"])])),_:2},1032,["text","content"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,l.createVNode)(u,{label:e.$t("modeling.combination.DictionaryOperator.5me6g9wp78o0"),labelCol:{span:6,offset:0},labelAlign:"left",colon:!1},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(n,{modelValue:(0,l.unref)(c).field,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,l.unref)(c).field=e),placeholder:e.$t("modeling.combination.DictionaryOperator.5me6g9wp7cg0"),"trigger-props":{contentClass:"d-a-select-dropdown"},allowSearch:"",style:{width:"100%"},onChange:t[3]||(t[3]=e=>g("field",(0,l.unref)(c).field))},{label:(0,l.withCtx)((({data:e})=>[(0,l.createVNode)(i["default"],{text:e?.label,content:e?.label,"other-width":0},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e?.label),1)])),_:2},1032,["text","content"])])),default:(0,l.withCtx)((()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(m),((e,t)=>((0,l.openBlock)(),(0,l.createBlock)(b,{key:`fieldsGroup${t}`,label:e.group},{label:(0,l.withCtx)((()=>[(0,l.createVNode)(i["default"],{text:e.group,content:e.group},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.group),1)])),_:2},1032,["text","content"])])),default:(0,l.withCtx)((()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.fields,((t,n)=>((0,l.openBlock)(),(0,l.createBlock)(i["default"],{text:t.name,key:`field${n}`,content:`${e.group} . ${t.name}`},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(a,{value:`${e.group}.${t.name}`,disabled:(0,l.unref)(o.checkDisabled)([(0,l.unref)(c).field],`${e.group}.${t.name}`),label:t.name},null,8,["value","disabled","label"])])),_:2},1032,["text","content"])))),128))])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,l.createVNode)(u,{label:e.$t("modeling.combination.DictionaryOperator.5me6g9wp7gw0"),labelCol:{span:6,offset:0},labelAlign:"left",colon:!1},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(n,{modelValue:(0,l.unref)(c).matchField,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,l.unref)(c).matchField=e),placeholder:e.$t("modeling.combination.DictionaryOperator.5me6g9wp7cg0"),"trigger-props":{contentClass:"d-a-select-dropdown"},allowSearch:"",style:{width:"100%"},onChange:t[5]||(t[5]=e=>g("matchField",(0,l.unref)(c).matchField))},{label:(0,l.withCtx)((({data:e})=>[(0,l.createVNode)(i["default"],{text:e?.label,content:e?.label,"other-width":0},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e?.label),1)])),_:2},1032,["text","content"])])),default:(0,l.withCtx)((()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(p((0,l.unref)(c).table),((e,t)=>((0,l.openBlock)(),(0,l.createBlock)(i["default"],{text:e.name,key:`field${t}`,content:`${e.name}`},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(a,{value:`${(0,l.unref)(c).table}.${e.name}`,disabled:(0,l.unref)(o.checkDisabled)([(0,l.unref)(c).matchField],`${(0,l.unref)(c).table}.${e.name}`),label:e.name},null,8,["value","disabled","label"])])),_:2},1032,["text","content"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,l.createVNode)(u,{label:e.$t("modeling.combination.DictionaryOperator.5me6g9wp7lc0"),labelCol:{span:6,offset:0},labelAlign:"left",colon:!1},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(n,{modelValue:(0,l.unref)(c).rigidField,"onUpdate:modelValue":t[6]||(t[6]=e=>(0,l.unref)(c).rigidField=e),placeholder:e.$t("modeling.combination.DictionaryOperator.5me6g9wp7cg0"),"trigger-props":{contentClass:"d-a-select-dropdown"},allowSearch:"",style:{width:"100%"},onChange:t[7]||(t[7]=e=>g("rigidField",(0,l.unref)(c).rigidField))},{label:(0,l.withCtx)((({data:e})=>[(0,l.createVNode)(i["default"],{text:e?.label,content:e?.label,"other-width":0},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e?.label),1)])),_:2},1032,["text","content"])])),default:(0,l.withCtx)((()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(p((0,l.unref)(c).table),((e,t)=>((0,l.openBlock)(),(0,l.createBlock)(i["default"],{text:e.name,key:`field${t}`,content:`${e.name}`},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(a,{value:`${(0,l.unref)(c).table}.${e.name}`,disabled:(0,l.unref)(o.checkDisabled)([(0,l.unref)(c).rigidField],`${(0,l.unref)(c).table}.${e.name}`),label:e.name},null,8,["value","disabled","label"])])),_:2},1032,["text","content"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])])),_:1},8,["title"])])),_:1},8,["activeKey"])}}}),u=a(83744);const s=(0,u.Z)(d,[["__scopeId","data-v-7f84b026"]]);var c=s}}]);
//# sourceMappingURL=6911.7b66285b.js.map