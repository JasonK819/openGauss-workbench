"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[3085],{23085:function(e,t,a){a.r(t),a.d(t,{default:function(){return I}});a(57658);var o=a(70821),l=a(98535),r=a(39518),s=a(15784),n=a(40225),d=a(57330);const i={class:"node-config-c"},m={class:"flex-col"},c={class:"flex-between",style:{width:"800px"}},u={class:"ft-b ft-m mb"},p={class:"mr"},h=(0,o.createTextVNode)(),g={class:"ft-lg"},f={class:"flex-col-start"},C={class:"node-top full-w mb"},N={class:"flex-row"},V={class:"flex-row"},b={class:"ft-m ft-b mb"};var w=(0,o.defineComponent)({setup(e,{expose:t}){const{t:a}=(0,d.QT)(),w=(0,n.BH)(),L=(0,o.reactive)({nodeList:[],azForm:{azId:"",azName:""},azRules:{},rules:{},hostListLoading:!1,hostObj:{},hostList:[],installUserObj:{},azListLoading:!1,azObj:{},azList:[],userListByHost:{}}),v=(0,o.ref)([]);(0,o.onMounted)((async()=>{I(),Object.keys(w.getEnterpriseConfig).length&&w.getEnterpriseConfig.nodeConfigList.length?(await k(),w.getEnterpriseConfig.nodeConfigList.forEach(((e,t)=>{L.nodeList.push(e),B(t)}))):(z(0,!0),z(1,!1),z(1,!1),k()),x()}));const I=()=>{L.azRules={azId:[{required:!0,"validate-trigger":"change",message:a("enterprise.NodeConfig.5mpme7w6ap00")}]},L.rules={hostId:[{required:!0,"validate-trigger":"change",message:a("enterprise.NodeConfig.5mpme7w6c1w0")}],rootPassword:[{required:!0,"validate-trigger":"blur",message:a("enterprise.NodeConfig.5mpme7w6b700")}],installUserId:[{required:!0,"validate-trigger":"change",message:a("enterprise.NodeConfig.5mpme7w6c5g0")}],cmPort:[{required:!0,"validate-trigger":"blur",message:a("enterprise.NodeConfig.5mpme7w6bko0")}],cmDataPath:[{required:!0,"validate-trigger":"blur",message:a("enterprise.NodeConfig.5mpme7w6c8s0")}],dataPath:[{required:!0,"validate-trigger":"blur",message:a("enterprise.NodeConfig.5mpme7w6cc40")}],xlogPath:[{required:!0,"validate-trigger":"blur",message:a("enterprise.NodeConfig.5mpme7w6cfw0")}]}},z=(e,t)=>{const a={clusterRole:l._.SLAVE,hostId:"",rootPassword:"",publicIp:"",privateIp:"",hostname:"",installUserId:"",installUsername:"",isInstallCM:!0,isCMMaster:!1,cmDataPath:"/opt/openGauss/data/cmserver",cmPort:"15300",dataPath:"/opt/openGauss/install/data/dn",xlogPath:"/opt/openGauss/install/data/xlog"};t&&(a.clusterRole=l._.MASTER,a.isCMMaster=!0),L.nodeList.splice(e+1,0,a)},U=e=>{0===e?s.Z.warning("The primary node cannot be removed"):L.nodeList.splice(e,1)},k=()=>{L.hostListLoading=!0,(0,r.zx)().then((e=>{200===Number(e.code)?(L.hostList=[],L.hostList=e.data,e.data.forEach((e=>{L.hostObj[e.hostId]=e})),L.nodeList.length&&!L.nodeList[0].hostId&&(L.nodeList[0].hostId=L.hostList[0].hostId,L.nodeList[0].privateIp=L.hostList[0].privateIp,L.nodeList[0].publicIp=L.hostList[0].publicIp),B(0)):s.Z.error("Failed to obtain the host list data")})).finally((()=>{L.hostListLoading=!1}))},x=()=>{L.azListLoading=!0,(0,r.$4)().then((e=>{200===Number(e.code)?(L.azList=[],L.azList=e.data,e.data.forEach((e=>{L.azObj[e.azId]=e.name})),L.azForm.azId=e.data[0].azId,L.azForm.azName=e.data[0].name):s.Z.error("Failed to obtain the AZ list data")})).finally((()=>{L.azListLoading=!1}))},y=()=>{L.azForm.azId&&L.azObj[L.azForm.azId]&&(L.azForm.azName=L.azObj[L.azForm.azId].name)},B=e=>{const t=L.nodeList[e].hostId;t&&(L.hostObj[t]&&(L.nodeList[e].privateIp=L.hostObj[t].privateIp,L.nodeList[e].publicIp=L.hostObj[t].publicIp,L.nodeList[e].hostname=L.hostObj[t].hostname),L.userListByHost[t]&&!L.nodeList[e].installUserId?(L.nodeList[e].installUserId=L.userListByHost[t][0].hostUserId,L.nodeList[e].installUsername=L.userListByHost[t][0].username):(0,r.YQ)(t).then((a=>{if(200===Number(a.code))if(a.data.length){L.userListByHost[t]=a.data,a.data.forEach((e=>{L.installUserObj[e.hostUserId]=e}));const o=L.nodeList[e].installUserId;if(o){const l=a.data.find((e=>e.hostUserId===o));l||(L.nodeList[e].installUserId=L.userListByHost[t][0].hostUserId,L.nodeList[e].installUsername=L.userListByHost[t][0].username)}else L.nodeList[e].installUserId=L.userListByHost[t][0].hostUserId,L.nodeList[e].installUsername=L.userListByHost[t][0].username}else L.nodeList[e].installUserId="",L.nodeList[e].installUsername="";else s.Z.error("Failed to obtain user data from the host")})))},_=(e,t)=>{const a=L.installUserObj[e];a&&(L.nodeList[t].installUsername=a.username)},E=e=>{switch(e){case l._.MASTER:return a("enterprise.NodeConfig.5mpme7w6ckk0");case l._.SLAVE:return a("enterprise.NodeConfig.5mpme7w6cng0");default:return a("enterprise.NodeConfig.5mpme7w6cqk0")}},P=e=>{e&&v.value.push(e)},$=async()=>{let e=!0;for(let t=0;t<v.value.length;t++)if(v.value[t]){const a=await v.value[t].validate();a&&(e=!1)}if(e){const e=JSON.parse(JSON.stringify(L.nodeList)),t={azId:L.azForm.azId,azName:L.azForm.azName,nodeConfigList:e};return w.setEnterpriseConfig(t),!0}return!1};return t({beforeConfirm:$}),(e,t)=>{const a=(0,o.resolveComponent)("a-option"),l=(0,o.resolveComponent)("a-select"),r=(0,o.resolveComponent)("a-form-item"),s=(0,o.resolveComponent)("a-form"),n=(0,o.resolveComponent)("a-tag"),d=(0,o.resolveComponent)("icon-plus-circle"),w=(0,o.resolveComponent)("icon-minus-circle"),v=(0,o.resolveComponent)("a-input-password"),I=(0,o.resolveComponent)("a-switch"),k=(0,o.resolveComponent)("a-col"),x=(0,o.resolveComponent)("a-row"),$=(0,o.resolveComponent)("a-input"),F=(0,o.resolveComponent)("a-divider");return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,[(0,o.createElementVNode)("div",m,[(0,o.createElementVNode)("div",c,[(0,o.createElementVNode)("div",u,[(0,o.createElementVNode)("span",p,(0,o.toDisplayString)(e.$t("enterprise.NodeConfig.5mpme7w69yc0")),1),h,(0,o.createElementVNode)("span",g,(0,o.toDisplayString)((0,o.unref)(L).nodeList.length),1)]),(0,o.createVNode)(s,{model:(0,o.unref)(L).azForm,rules:(0,o.unref)(L).azRules,style:{width:"300px"},"auto-label-width":"",ref:(e,t)=>{t["azFormRef"]=e}},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{field:"azId",label:e.$t("enterprise.NodeConfig.5mpme7w6aj40"),"validate-trigger":"change"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{loading:(0,o.unref)(L).azListLoading,modelValue:(0,o.unref)(L).azForm.azId,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,o.unref)(L).azForm.azId=e),placeholder:e.$t("enterprise.NodeConfig.5mpme7w6ap00"),onChange:y},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(L).azList,(e=>((0,o.openBlock)(),(0,o.createBlock)(a,{key:e.azId,value:e.azId},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["loading","modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model","rules"])]),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(L).nodeList,((t,i)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:i},[(0,o.createElementVNode)("div",f,[(0,o.createElementVNode)("div",C,[(0,o.createElementVNode)("div",N,[(0,o.createVNode)(n,{color:"#86909C",class:"mr-s"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(E(t.clusterRole)),1)])),_:2},1024),(0,o.createTextVNode)(" "+(0,o.toDisplayString)(e.$t("enterprise.NodeConfig.5mpme7w6aw80")),1)]),(0,o.createElementVNode)("div",V,[(0,o.createVNode)(d,{class:"add-icon-size mr",style:{color:"green"},onClick:e=>z(i)},null,8,["onClick"]),i>2?((0,o.openBlock)(),(0,o.createBlock)(w,{key:0,class:"remove-icon add-icon-size",onClick:e=>U(i)},null,8,["onClick"])):(0,o.createCommentVNode)("",!0)])]),(0,o.createVNode)(s,{model:t,rules:(0,o.unref)(L).rules,style:{width:"800px"},"auto-label-width":"",ref:P},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{field:"hostId",label:e.$t("enterprise.NodeConfig.5mpme7w6azo0")},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{loading:(0,o.unref)(L).hostListLoading,modelValue:t.hostId,"onUpdate:modelValue":e=>t.hostId=e,onChange:e=>B(i),placeholder:e.$t("enterprise.NodeConfig.5mpme7w6b3k0")},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(L).hostList,(e=>((0,o.openBlock)(),(0,o.createBlock)(a,{key:e.hostId,value:e.hostId},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.publicIp+"("+(e.hostname?e.hostname:"--")+")"),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["loading","modelValue","onUpdate:modelValue","onChange","placeholder"])])),_:2},1032,["label"]),(0,o.createVNode)(r,{field:"rootPassword",label:e.$t("enterprise.NodeConfig.else2"),"validate-trigger":"blur"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{modelValue:t.rootPassword,"onUpdate:modelValue":e=>t.rootPassword=e,placeholder:e.$t("enterprise.NodeConfig.5mpme7w6b700"),"allow-clear":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"]),(0,o.createVNode)(r,{field:"installUserId",label:e.$t("enterprise.NodeConfig.5mpme7w6bak0")},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{modelValue:t.installUserId,"onUpdate:modelValue":e=>t.installUserId=e,onChange:e=>_(e,i)},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(L).userListByHost[t.hostId],(e=>((0,o.openBlock)(),(0,o.createBlock)(a,{key:e.hostUserId,value:e.hostUserId},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.username),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1032,["label"]),(0,o.createVNode)(x,{gutter:24},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(k,{span:12},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{field:"isInstallCM",label:e.$t("enterprise.NodeConfig.else3")},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(I,{modelValue:t.isInstallCM,"onUpdate:modelValue":e=>t.isInstallCM=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])])),_:2},1024),(0,o.createVNode)(k,{span:12},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{field:"isCMMaster",label:e.$t("enterprise.NodeConfig.5mpme7w6be40")},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(I,{modelValue:t.isCMMaster,"onUpdate:modelValue":e=>t.isCMMaster=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])])),_:2},1024)])),_:2},1024),(0,o.createVNode)(r,{field:"cmDataPath",label:e.$t("enterprise.NodeConfig.else4"),"validate-trigger":"blur"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{modelValue:t.cmDataPath,"onUpdate:modelValue":e=>t.cmDataPath=e,placeholder:e.$t("enterprise.NodeConfig.5mpme7w6bhg0")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"]),(0,o.createVNode)(r,{field:"cmPort",label:e.$t("enterprise.NodeConfig.else5"),"validate-trigger":"blur"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{modelValue:t.cmPort,"onUpdate:modelValue":e=>t.cmPort=e,placeholder:e.$t("enterprise.NodeConfig.5mpme7w6bko0")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"]),(0,o.createElementVNode)("div",b,(0,o.toDisplayString)(e.$t("enterprise.NodeConfig.5mpme7w6boc0")),1),(0,o.createVNode)(r,{field:"dataPath",label:e.$t("enterprise.NodeConfig.5mpme7w6brs0"),"validate-trigger":"blur"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{modelValue:t.dataPath,"onUpdate:modelValue":e=>t.dataPath=e,placeholder:e.$t("enterprise.NodeConfig.5mpme7w6bv40")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"]),(0,o.createVNode)(r,{field:"xlogPath",label:e.$t("enterprise.NodeConfig.else1"),"validate-trigger":"blur"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{modelValue:t.xlogPath,"onUpdate:modelValue":e=>t.xlogPath=e,placeholder:e.$t("enterprise.NodeConfig.5mpme7w6byo0")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"])])),_:2},1032,["model","rules"]),i<(0,o.unref)(L).nodeList.length-1?((0,o.openBlock)(),(0,o.createBlock)(F,{key:0})):(0,o.createCommentVNode)("",!0)])])))),128))])])}}}),L=a(83744);const v=(0,L.Z)(w,[["__scopeId","data-v-04c83302"]]);var I=v}}]);
//# sourceMappingURL=3085.7217cdcd.js.map