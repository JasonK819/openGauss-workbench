"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[7085],{89965:function(e,t,a){a.d(t,{AH:function(){return p},Bd:function(){return g},C7:function(){return S},DG:function(){return J},Du:function(){return Z},H7:function(){return L},Iz:function(){return z},J6:function(){return O},Jh:function(){return h},NQ:function(){return E},QS:function(){return x},Qt:function(){return y},R7:function(){return B},Rq:function(){return m},SB:function(){return f},SW:function(){return C},UL:function(){return c},Up:function(){return v},WK:function(){return N},Yn:function(){return _},gp:function(){return s},j9:function(){return R},nB:function(){return $},qR:function(){return k},qo:function(){return b},sZ:function(){return D},v$:function(){return u},vs:function(){return i},w0:function(){return F},wB:function(){return I},x9:function(){return q},xl:function(){return V},yA:function(){return d},yf:function(){return U}});var o=a(15784),n=a(9669),l=a.n(n),r=a(90989);const i=(e,t,a,o)=>l().get(`/modeling/dataflow/dataSourceDb/getTablesBySchema/${e}/${t}/${a}`,o||{}),d=(e,t)=>l().get(`/modeling/dataflow/dataSourceDb/getFieldsByTable/${e}`,t||{}),s=e=>l().get("/modeling/dataflow/list",{params:e}),u=e=>l().post("/modeling/dataflow/add",e||{}),m=e=>l()["delete"](`/modeling/dataflow/delete/${e}`),c=e=>l().put("/modeling/dataflow/edit",e||{}),g=e=>l().get(`/modeling/dataflow/getById/${e}`),f=(e,t)=>l().get(`/modeling/dataflow/dataSourceDb/getSchemaByClusterNodeId/${e}/${t}`,e||{}),p=e=>l().post("/modeling/dataflow/getSql",e||{}),h=e=>l().post("/modeling/dataflow/runSql",e||{});let w=!0;const v=(e,t,a)=>new Promise((n=>{w&&(w=!1,l().put("/modeling/dataflow/edit",{id:e,operatorContent:JSON.stringify(t)}).then((e=>{n(!0),w=!0,200===Number(e.code)&&(a||o.Z.success({content:r.Z.global.t("modeling.dy_common.saveSuccess")}))})).catch((()=>{n(!1),a||o.Z.error({content:r.Z.global.t("modeling.dy_common.saveFailed")}),w=!0})))})),b=e=>l().get("/modeling/dataflow/dataSourceDb/list",e||{}),N=e=>l().post("/modeling/dataflow/getResultFieldsByOperator",e||{}),C=e=>l().post("/modeling/dataflow/visualization/params/add",e||{}),U=e=>l().put("/modeling/dataflow/visualization/params/edit",e||{}),B=e=>l()["delete"](`/modeling/dataflow/visualization/params/delete/${e}`),V=e=>l().post("/modeling/dataflow/visualization/params/generateChart",e||{}),$=(e,t)=>l().get(`/modeling/dataflow/visualization/params/getListByOperatorId/${e}`,t||{}),k=e=>l().post("/modeling/dataflow/visualization/snapshot/add",e||{}),x=(e,t)=>l().get(`/modeling/dataflow/visualization/snapshot/getListByDataFlowId/${e}`,t||{}),y=e=>l()["delete"](`/modeling/dataflow/visualization/snapshot/delete/${e}`),D=(e,t)=>l().get(`/modeling/dataflow/visualization/report/getListByDataFlowId/${e}`,{params:t||{}}),I=e=>l().post("/modeling/dataflow/visualization/report/add",e||{}),S=e=>l().put("/modeling/dataflow/visualization/report/update",e||{}),z=e=>l()["delete"](`/modeling/dataflow/visualization/report/delete/${e}`),Z=e=>l().get(`/modeling/dataflow/visualization/report/share/getByReportId/${e}`),_=(e,t)=>l().get(`/modeling/dataflow/visualization/customDimension/getListByOperatorId/${e}`,{params:t||{}}),O=e=>l().post("/modeling/dataflow/visualization/customDimension/add",e||{}),E=e=>l().put("/modeling/dataflow/visualization/customDimension/edit",e||{}),L=e=>l()["delete"](`/modeling/dataflow/visualization/customDimension/delete/${e}`),q=(e,t)=>l().get(`/modeling/visualization/report/share/getMapGeo/${e}`,t||{}),J=e=>l().post("/modeling/dataflow/visualization/params/uploadGeo",e||{}),F=(e,t)=>l().get(`/modeling/dataflow/visualization/params/getGeo/${e}`,{params:t||{}}),R=e=>l()["delete"](`/modeling/dataflow/visualization/params/deleteGeo/${e}`)},83744:function(e,t){t.Z=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a}},37085:function(e,t,a){a.r(t),a.d(t,{default:function(){return w}});a(57658);var o=a(70821),n=a(15784),l=a(882),r=a(2811),i=a(38655),d=a(18933),s=a(56961),u=a(77688),m=a(89965),c=a(57330);const g={class:"cu-dialog"};var f=(0,o.defineComponent)({emits:["finish"],setup(e,{expose:t,emit:a}){const{t:f}=(0,c.QT)(),p=(f("modeling.components.CU.5m6g1w13i3g0"),f("modeling.components.CU.5m6g1w13i640"),f("modeling.components.CU.5m6g1w13i8k0"),(0,o.reactive)({show:!1,loading:!1,title:f("modeling.components.CU.5m6g1w13iaw0"),formData:{name:"",users:[],dataBase:[],tags:"",clusterId:"",clusterNodeId:"",dbName:"",schema:"",user:"",remark:"",type:""},formModal:{name:"",dataBase:[],tags:"",clusterId:"",clusterNodeId:"",dbName:"",schema:"",users:[{id:1,name:"",role:1,type:"creator"}],remark:"",type:""},rules:{}})),h=(e,t)=>{if(p.show=!0,p.rules={name:[{required:!0,"validate-trigger":"blur",message:f("modeling.components.CU.5m6g1w13h7c0")}],id:[{required:!0,"validate-trigger":"blur",message:f("modeling.components.CU.5m6g1w13id80")}],dataBase:[{required:!0,"validate-trigger":"blur",message:f("modeling.components.CU.5m6g1w13hdo0")}],tags:[{required:!0,"validate-trigger":"blur",message:f("modeling.components.CU.5m6g1w13hiw0")}],type:[{required:!0,"validate-trigger":"blur",message:f("modeling.components.CU.5m6g1w13ihs0")}],user:[{required:!0,"validate-trigger":"blur",message:f("modeling.components.CU.5m6g1w13ik00")}]},"create"===e)p.formData=JSON.parse(JSON.stringify(p.formModal)),p.title=f("modeling.components.CU.5m6g1w13iaw0");else if("update"===e&&t){let e=JSON.parse(JSON.stringify(p.formModal));for(let a in e)t[a]&&(e[a]=t[a]);e.dataBase=[e.clusterId,e.clusterNodeId,e.dbName,e.schema],t.manager&&t.manager.split(",").forEach((t=>t&&""!==t&&e.users.push({name:t,id:e.users.length+1,role:1}))),t.developer&&t.developer.split(",").forEach((t=>t&&""!==t&&e.users.push({name:t,id:e.users.length+1,role:2}))),t.visitor&&t.visitor.split(",").forEach((t=>t&&""!==t&&e.users.push({name:t,id:e.users.length+1,role:3}))),e.id=t.id,p.title=f("modeling.components.CU.5m6g1w13ing0"),p.formData=e}B()},w=(0,o.ref)(null),v=()=>{p.show=!1,(0,o.nextTick)((()=>{w.value?.clearValidate(),w.value?.resetFields()}))},b=()=>{w.value?.validate().then((e=>{if(!e){p.loading=!0;let e={...JSON.parse(JSON.stringify(p.formData)),manager:"",developer:"",visitor:""};e.users.forEach((t=>{1===Number(t.role)?e.manager+=e.manager?`,${t.name}`:t.name:2===Number(t.role)?e.developer+=e.developer?`,${t.name}`:t.name:3===Number(t.role)&&(e.visitor+=e.visitor?`,${t.name}`:t.name)})),e.clusterId=e.dataBase[0],e.clusterNodeId=e.dataBase[1],e.dbName=e.dataBase[2],e.schema=e.dataBase[3],e.dataBase=1,e.id?(0,m.UL)(e).then((e=>{p.loading=!1,200===Number(e.code)&&(n.Z.success({content:f("modeling.components.CU.submitok2")}),a("finish","update")),v()})).catch((()=>{p.loading=!1})):(0,m.v$)(e).then((e=>{p.loading=!1,200===Number(e.code)&&(n.Z.success({content:f("modeling.components.CU.submitok1")}),a("finish","create")),v()})).catch((()=>{p.loading=!1}))}})).catch((()=>{p.loading=!1}))},N=(0,o.ref)(),C=e=>{p.formData.users=[...p.formData.users,...e]},U=(0,o.ref)([]),B=()=>{(0,m.qo)().then((e=>{e.data.forEach((e=>{e.value=e.clusterId,e.label=e.clusterId,e.clusterNodes&&e.clusterNodes.forEach((e=>{e.label=e.azName+"_"+e.publicIp,e.value=e.nodeId;let t=[];e.dbName=JSON.parse(e.dbName),e.dbName.forEach((a=>{t.push({label:a,value:a,parentId:e.nodeId})})),e.children=t})),e.children=e.clusterNodes})),console.log(e.data),U.value=e.data}))},V=(e,t)=>{(0,m.SB)(e.value,e.parentId).then((e=>{200===Number(e.code)?t(e.data.map((e=>({label:e,value:e,isLeaf:!0})))):t([])})).catch((()=>{t([])}))},$=e=>{let t=[],a=U.value.findIndex((t=>t.value===e[0]));if(-1!==a){t.push(U.value[a].label);let o=U.value[a].children.findIndex((t=>t.value=e[1]));return-1===o?e.join(" / "):(t.push(U.value[a].children[o].label),t.push(e[2]),t.push(e[3]),t.join(" / "))}return e.join(" / ")};return t({open:h}),(e,t)=>{const a=(0,o.resolveComponent)("a-cascader");return(0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,[(0,o.createVNode)((0,o.unref)(l.Z),{class:"cu-container",visible:(0,o.unref)(p).show,title:(0,o.unref)(p).title,"ok-loading":(0,o.unref)(p).loading,"ok-text":e.$t("modeling.components.CU.5m6g1w13gjo0"),"cancel-text":e.$t("modeling.components.CU.5m6g1w13gz40"),onOk:b,onCancel:v,"modal-style":{width:"750px"}},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",g,[(0,o.createVNode)((0,o.unref)(r.Z),{model:(0,o.unref)(p).formData,ref:(e,t)=>{t["formRef"]=e,w.value=e},"label-col":{style:{width:"90px"}},rules:(0,o.unref)(p).rules},{default:(0,o.withCtx)((()=>[(0,o.createVNode)((0,o.unref)(i.Z),{field:"name",label:e.$t("modeling.components.CU.5m6g1w13h2w0"),"validate-trigger":"blur"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)((0,o.unref)(d.ZP),{"max-length":140,"show-word-limit":"",modelValue:(0,o.unref)(p).formData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,o.unref)(p).formData.name=e),placeholder:e.$t("modeling.components.CU.5m6g1w13h7c0")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,o.createVNode)((0,o.unref)(i.Z),{field:"dataBase",label:e.$t("modeling.components.CU.5m6g1w13ha80"),"validate-trigger":"change"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(a,{"path-mode":"",modelValue:(0,o.unref)(p).formData.dataBase,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,o.unref)(p).formData.dataBase=e),options:U.value,placeholder:e.$t("modeling.components.CU.5m6g1w13hdo0"),"load-more":V,fallback:$},null,8,["modelValue","options","placeholder"])])),_:1},8,["label"]),(0,o.createVNode)((0,o.unref)(i.Z),{field:"tags",label:e.$t("modeling.components.CU.5m6g1w13hgc0"),"validate-trigger":"blur"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)((0,o.unref)(d.ZP),{"max-length":140,"show-word-limit":"",modelValue:(0,o.unref)(p).formData.tags,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,o.unref)(p).formData.tags=e),placeholder:e.$t("modeling.components.CU.5m6g1w13hiw0")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,o.createVNode)((0,o.unref)(i.Z),{field:"remark",label:e.$t("modeling.components.CU.5m6g1w13hyo0"),"validate-trigger":"blur"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)((0,o.unref)(s.Z),{modelValue:(0,o.unref)(p).formData.remark,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,o.unref)(p).formData.remark=e),placeholder:e.$t("modeling.components.CU.5m6g1w13i180"),"max-length":500},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model","rules"])])])),_:1},8,["visible","title","ok-loading","ok-text","cancel-text"]),(0,o.createVNode)(u["default"],{ref:(e,t)=>{t["userRef"]=e,N.value=e},onSuccess:C},null,512)],64)}}}),p=a(83744);const h=(0,p.Z)(f,[["__scopeId","data-v-08410ad4"]]);var w=h},77688:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var o=a(70821),n=a(96336),l=a(882),r=a(72453),i=a(57330);const d={class:"d-content"},s={class:"select-role"};var u=(0,o.defineComponent)({emits:["success"],setup(e,{expose:t,emit:a}){const{t:u}=(0,i.QT)(),m=n.ZP.Option,c=[],g=(0,o.reactive)({show:!1,title:u("modeling.components.CUUser.5mpu44y3ivw0"),loading:!1,userList:[],roles:[]}),f=()=>{g.show=!1},p=(e,t)=>{g.show=!0,g.roles=e,g.userList=c.filter((e=>-1===t.findIndex((t=>t.name===e.name))))},h=()=>{a("success",JSON.parse(JSON.stringify(g.userList.filter((e=>e.selected))))),f()};return t({open:p}),(e,t)=>((0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(l.Z),{class:"cu-user-container",visible:(0,o.unref)(g).show,"onUpdate:visible":t[0]||(t[0]=e=>(0,o.unref)(g).show=e),title:(0,o.unref)(g).title,"ok-text":e.$t("modeling.components.CUUser.5mpu44y3ic40"),"confirm-loading":(0,o.unref)(g).loading,"cancel-text":e.$t("modeling.components.CUUser.5mpu44y3iso0"),onOk:h,onCancel:f,"modal-style":{width:"400px"}},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",d,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(g).userList,((e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",{class:"d-row",key:`userlist${t}`},[(0,o.createVNode)((0,o.unref)(r.Z),{modelValue:e.selected,"onUpdate:modelValue":t=>e.selected=t},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.name),1)])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,o.withDirectives)((0,o.createElementVNode)("div",s,[(0,o.createVNode)((0,o.unref)(n.ZP),{modelValue:e.role,"onUpdate:modelValue":t=>e.role=t},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(g).roles,((e,t)=>((0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(m),{key:`role${t}`,value:e.id},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.name),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])],512),[[o.vShow,e.selected]])])))),128))])])),_:1},8,["visible","title","ok-text","confirm-loading","cancel-text"]))}}),m=a(83744);const c=(0,m.Z)(u,[["__scopeId","data-v-0add7196"]]);var g=c}}]);
//# sourceMappingURL=7085.7bb50ddc.js.map