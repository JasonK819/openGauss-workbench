"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[7643],{89965:function(e,t,a){a.d(t,{AH:function(){return g},Bd:function(){return m},C7:function(){return x},DG:function(){return E},Du:function(){return Z},H7:function(){return R},Iz:function(){return _},J6:function(){return V},Jh:function(){return b},NQ:function(){return O},QS:function(){return k},Qt:function(){return C},R7:function(){return N},Rq:function(){return c},SB:function(){return p},SW:function(){return y},UL:function(){return f},Up:function(){return w},WK:function(){return v},Yn:function(){return F},gp:function(){return r},j9:function(){return q},nB:function(){return I},qR:function(){return B},qo:function(){return D},sZ:function(){return T},v$:function(){return u},vs:function(){return i},w0:function(){return P},wB:function(){return z},x9:function(){return j},xl:function(){return S},yA:function(){return d},yf:function(){return $}});var n=a(15784),o=a(9669),s=a.n(o),l=a(90989);const i=(e,t,a,n)=>s().get(`/modeling/dataflow/dataSourceDb/getTablesBySchema/${e}/${t}/${a}`,n||{}),d=(e,t)=>s().get(`/modeling/dataflow/dataSourceDb/getFieldsByTable/${e}`,t||{}),r=e=>s().get("/modeling/dataflow/list",{params:e}),u=e=>s().post("/modeling/dataflow/add",e||{}),c=e=>s()["delete"](`/modeling/dataflow/delete/${e}`),f=e=>s().put("/modeling/dataflow/edit",e||{}),m=e=>s().get(`/modeling/dataflow/getById/${e}`),p=(e,t)=>s().get(`/modeling/dataflow/dataSourceDb/getSchemaByClusterNodeId/${e}/${t}`,e||{}),g=e=>s().post("/modeling/dataflow/getSql",e||{}),b=e=>s().post("/modeling/dataflow/runSql",e||{});let h=!0;const w=(e,t,a)=>new Promise((o=>{h&&(h=!1,s().put("/modeling/dataflow/edit",{id:e,operatorContent:JSON.stringify(t)}).then((e=>{o(!0),h=!0,200===Number(e.code)&&(a||n.Z.success({content:l.Z.global.t("modeling.dy_common.saveSuccess")}))})).catch((()=>{o(!1),a||n.Z.error({content:l.Z.global.t("modeling.dy_common.saveFailed")}),h=!0})))})),D=e=>s().get("/modeling/dataflow/dataSourceDb/list",e||{}),v=e=>s().post("/modeling/dataflow/getResultFieldsByOperator",e||{}),y=e=>s().post("/modeling/dataflow/visualization/params/add",e||{}),$=e=>s().put("/modeling/dataflow/visualization/params/edit",e||{}),N=e=>s()["delete"](`/modeling/dataflow/visualization/params/delete/${e}`),S=e=>s().post("/modeling/dataflow/visualization/params/generateChart",e||{}),I=(e,t)=>s().get(`/modeling/dataflow/visualization/params/getListByOperatorId/${e}`,t||{}),B=e=>s().post("/modeling/dataflow/visualization/snapshot/add",e||{}),k=(e,t)=>s().get(`/modeling/dataflow/visualization/snapshot/getListByDataFlowId/${e}`,t||{}),C=e=>s()["delete"](`/modeling/dataflow/visualization/snapshot/delete/${e}`),T=(e,t)=>s().get(`/modeling/dataflow/visualization/report/getListByDataFlowId/${e}`,{params:t||{}}),z=e=>s().post("/modeling/dataflow/visualization/report/add",e||{}),x=e=>s().put("/modeling/dataflow/visualization/report/update",e||{}),_=e=>s()["delete"](`/modeling/dataflow/visualization/report/delete/${e}`),Z=e=>s().get(`/modeling/dataflow/visualization/report/share/getByReportId/${e}`),F=(e,t)=>s().get(`/modeling/dataflow/visualization/customDimension/getListByOperatorId/${e}`,{params:t||{}}),V=e=>s().post("/modeling/dataflow/visualization/customDimension/add",e||{}),O=e=>s().put("/modeling/dataflow/visualization/customDimension/edit",e||{}),R=e=>s()["delete"](`/modeling/dataflow/visualization/customDimension/delete/${e}`),j=(e,t)=>s().get(`/modeling/visualization/report/share/getMapGeo/${e}`,t||{}),E=e=>s().post("/modeling/dataflow/visualization/params/uploadGeo",e||{}),P=(e,t)=>s().get(`/modeling/dataflow/visualization/params/getGeo/${e}`,{params:t||{}}),q=e=>s()["delete"](`/modeling/dataflow/visualization/params/deleteGeo/${e}`)},43610:function(e,t,a){a.d(t,{m:function(){return o}});a(57658);var n=a(95684);const o=(0,n.Q_)("modeling-common",{state:()=>({currentSelectData:{},selectNode:null,showConfig:!1,isRegisterNodes:[],rules:{},nodeEventData:null,i18n:null}),getters:{getI18n:e=>e.i18n,getCurrentSelectData:e=>e.currentSelectData,getSelectNode:e=>e.selectNode,getRules:e=>e.rules},actions:{setI18n(e){this.$patch((t=>{t.i18n=e}))},nodeEvent(e){this.nodeEventData=e},setIsResigterNodes(e){this.$patch((t=>{t.isRegisterNodes.push(e)}))},setSelectNode(e,t){this.$patch((a=>{a.showConfig=t,a.selectNode=e}))},setSelectData(){const e=[{id:5,name:"hs.article",fields:[{id:1,name:"article.type"},{id:2,name:"article.title"},{id:3,name:"article.content"}]},{id:1,name:"hs.user_test",fields:[{id:1,name:"user.name"},{id:2,name:"user.sex"},{id:3,name:"user.age"}]}];this.currentSelectData=e},setRule(e,t){this.$patch((a=>{a.rules[e]=t}))}}})},8603:function(e,t,a){a.d(t,{M:function(){return i}});a(57658);var n=a(89965),o=a(95684),s=a(15784);const l={graph:null,dataFlowInfo:{},rawData:{},useData:{},useDatabase:"",useTable:[]},i=(0,o.Q_)("dataFlow",{state(){return JSON.parse(JSON.stringify(l))},getters:{getTableSelectList:e=>e.useDatabase?e.useData[e.useDatabase]:[],getFieldsSelectList:e=>{if(e.useDatabase&&e.useTable.length>0){const t=e.useData[e.useDatabase],a=[];return e.useTable.forEach((e=>{const n={group:e,fields:[]},o=t.findIndex((t=>t.tablename===e));-1!==o&&(n.fields=t[o].fields),a.push(n)})),a}return[]},getFlowDataInfo:e=>e.dataFlowInfo,getFieldsByTable:e=>t=>{if(e.useDatabase){const a=e.useData[e.useDatabase];if(0===t||"0"===t){const t=a.findIndex((t=>t.tablename===e.useTable[0]));return-1===t?[]:a[t].fields}{const e=a.findIndex((e=>e.tablename===t));return-1===e?[]:a[e].fields}}return[]},getUseTable:e=>e.useTable,getUseDatabase:e=>e.useDatabase},actions:{setGraph(e){this.$patch((t=>{t.graph=e}))},initState(){return new Promise((e=>{this.$patch((t=>{t.useData=[],t.useDatabase="",t.useTable=[],t.rawData=[],t.dataFlowInfo=[],e(!0)}))}))},clearUse(){return new Promise((e=>{this.$patch((t=>{t.useDatabase="",t.useTable=[],e(!0)}))}))},setFlowDataInfo(e){this.$patch((t=>t.dataFlowInfo=e))},setDatabaseInfo(e,t,a){return new Promise(((o,l)=>{this.$patch((i=>{i.useDatabase=`${e}|,|${t}|,|${a}`,i.useTable=[],Object.keys(i.rawData).includes(`${e}|,|${t}|,|${a}`)?o(!0):(0,n.vs)(e,t,a).then((n=>{if(200===Number(n.code)){const s=n.data.map((e=>({...e,tables:{}})));i.rawData[`${e}|,|${t}|,|${a}`]=s,i.useData[`${e}|,|${t}|,|${a}`]=s,o(!0)}else s.Z.error("database not found"),l(!0)})).catch((()=>{s.Z.error("database not found"),l(!0)}))}))}))},setDatabaseTableInfo(e,t){return new Promise((a=>{this.$patch((o=>{if(e){t&&(t.tableKey||0===t.tableKey)?o.useTable[t.tableKey]=e:t&&t.noUse||o.useTable.push(e);const s=o.rawData[o.useDatabase].findIndex((t=>t.tablename===e));Object.keys(o.rawData[o.useDatabase][s].tables).includes(e)?a(!1):(0,n.yA)(`${o.useDatabase.split("|,|").join("/")}/${e}`).then((e=>{a(!0),o.rawData[o.useDatabase][s].fields=e.data,o.useData[o.useDatabase][s].fields=e.data}))}else a(!1)}))}))},removeDatabaseTable(e){return new Promise((t=>{this.$patch((a=>{const n=a.useTable.indexOf(e);-1!==n?(a.useTable.splice(n,1),t(!0)):t(!1)}))}))}}})},83744:function(e,t){t.Z=(e,t)=>{const a=e.__vccOpts||e;for(const[n,o]of t)a[n]=o;return a}},17643:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var n=a(70821),o=a(66254),s=a(82212),l=a(72175),i=a(82518),d=a(9958),r=a(43610),u=a(67753),c=a(8603);const f={key:0,class:"base-node-icon"},m={class:"name"};var p=(0,n.defineComponent)({setup(e){const t=(0,r.m)(),a=(0,c.M)(),p=t.getI18n,g=(0,n.inject)("getNode"),b=(0,n.inject)("getGraph"),h=(0,n.inject)("node-event");let w=(0,n.ref)({});const D=(0,n.ref)(!1),v=(0,n.ref)(!1),y=(0,n.ref)(!1),$=(0,n.ref)(!1);(0,n.onMounted)((()=>{if(g){let e=g();e&&e.data&&e.data.cells_type&&"dataSource"!==e.data.cells_type&&($.value=!0),e.on("change:data",(({current:e})=>{D.value=!!e.antvSelected&&e.antvSelected,y.value=!!e.showDisabledCheckbox&&e.showDisabledCheckbox}))}}));const N=()=>g?w=g().getData():setTimeout((()=>{N()}),100);N();const S=()=>{if(!v.value){let e=b(),n=g(),o=e.getPredecessors(n,{deep:!0});const s=a.getFlowDataInfo;a.setFlowDataInfo(s);let l=s.clusterNodeId,i=s.schema,d=s.dbName,r=o.findIndex((e=>"BaseNode"===e.shape&&e.data&&"dataSource"===e.data.cells_type));if(-1!==r||n&&n.data&&"dataSource"===n.data.cells_type){let e=-1!==r?o[r]:n;e&&e.data&&e.data.source&&e.data.source.length>0&&(d=e.data.source[2],l=e.data.source[1],i=e.data.source[3])}a.setDatabaseInfo(d,l,i).then((()=>{let e=o.findIndex((e=>"BaseNode"===e.shape&&e.data&&["query","insert","delete","update"].includes(e.data.cells_type)));-1!==e&&o[e].data.table&&a.setDatabaseTableInfo(o[e].data.table),"BaseNode"===n.shape&&n.data&&["query","insert","delete","update"].includes(n.data.cells_type)&&a.setDatabaseTableInfo(n.data.table);let s=o.findIndex((e=>"BaseNode"===e.shape&&e.data&&"join"===e.data.cells_type));-1!==s&&o[s].data.table&&a.setDatabaseTableInfo(o[s].data.table),"BaseNode"===n.shape&&n.data&&"join"===n.data.cells_type&&a.setDatabaseTableInfo(n.data.table),g&&t.setSelectNode(n,!0)}))}},I=()=>{let e=g();e&&h("visual-edit",e)},B=e=>{if(b&&g){let t=b(),a=g();"delete"===e?t.removeNode(a.id):"copy"===e?(t.copy([a]),t.paste()):"cut"===e&&t.cut([a])}},k=()=>{if(v.value=!v.value||!v.value,g){let e=g();e.setData({disabled:v.value})}};return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(s.ZP),{trigger:"contextMenu",alignPoint:"",position:"bl"},{content:(0,n.withCtx)((()=>[!(0,n.unref)(w).operate||(0,n.unref)(w).operate.includes("cut")?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(l.Z),{key:"1",onClick:t[0]||(t[0]=e=>B("cut"))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)((0,n.unref)(p)("modeling.nodes.BaseNode.5m78v3ubttc0")),1)])),_:1})):(0,n.createCommentVNode)("",!0),!(0,n.unref)(w).operate||(0,n.unref)(w).operate.includes("copy")?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(l.Z),{key:"2",onClick:t[1]||(t[1]=e=>B("copy"))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)((0,n.unref)(p)("modeling.nodes.BaseNode.5m78v3ubuac0")),1)])),_:1})):(0,n.createCommentVNode)("",!0),!(0,n.unref)(w).operate||(0,n.unref)(w).operate.includes("delete")?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(l.Z),{key:"3",onClick:t[2]||(t[2]=e=>B("delete"))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)((0,n.unref)(p)("modeling.nodes.BaseNode.5m78v3ubuek0")),1)])),_:1})):(0,n.createCommentVNode)("",!0)])),default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",{class:(0,n.normalizeClass)(["d-antv-node base-node-container",{"d-antv-node-selected":D.value,"d-antv-node-disabled":v.value}])},[(0,n.createElementVNode)("div",{class:(0,n.normalizeClass)(["base-node-disabled",{"open-base-node-disabled":y.value}])},[(0,n.createElementVNode)("div",{class:"disabled-frame",onClick:k},[(0,n.withDirectives)((0,n.createVNode)((0,n.unref)(i.Z),null,null,512),[[n.vShow,v.value]])])],2),(0,n.unref)(w).icon?((0,n.openBlock)(),(0,n.createElementBlock)("div",f,[(0,n.unref)(w).icon?((0,n.openBlock)(),(0,n.createBlock)(u.Z,{key:0,class:"bs-i","icon-class":(0,n.unref)(w).icon},null,8,["icon-class"])):(0,n.createCommentVNode)("",!0)])):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",m,(0,n.toDisplayString)((0,n.unref)(w).text),1),(0,n.withDirectives)((0,n.createVNode)((0,n.unref)(d.Z),{class:"base-node-play",onClick:(0,n.withModifiers)(I,["stop"])},null,8,["onClick"]),[[n.vShow,$.value]]),(0,n.createVNode)((0,n.unref)(o.Z),{class:"base-node-settings",onClick:(0,n.withModifiers)(S,["stop"])},null,8,["onClick"])],2)])),_:1}))}}),g=a(83744);const b=(0,g.Z)(p,[["__scopeId","data-v-572a1508"]]);var h=b}}]);
//# sourceMappingURL=7643.3ac2404e.js.map