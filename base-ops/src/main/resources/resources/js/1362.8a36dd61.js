"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[1362,8208],{89965:function(e,t,a){a.d(t,{AH:function(){return m},Bd:function(){return f},C7:function(){return _},DG:function(){return J},Du:function(){return Z},H7:function(){return O},Iz:function(){return N},J6:function(){return E},Jh:function(){return h},NQ:function(){return F},QS:function(){return k},Qt:function(){return C},R7:function(){return $},Rq:function(){return c},SB:function(){return p},SW:function(){return D},UL:function(){return g},Up:function(){return w},WK:function(){return v},Yn:function(){return P},gp:function(){return d},j9:function(){return j},nB:function(){return z},qR:function(){return B},qo:function(){return y},sZ:function(){return T},v$:function(){return u},vs:function(){return r},w0:function(){return R},wB:function(){return x},x9:function(){return A},xl:function(){return I},yA:function(){return s},yf:function(){return S}});var n=a(15784),o=a(9669),i=a.n(o),l=a(90989);const r=(e,t,a,n)=>i().get(`/modeling/dataflow/dataSourceDb/getTablesBySchema/${e}/${t}/${a}`,n||{}),s=(e,t)=>i().get(`/modeling/dataflow/dataSourceDb/getFieldsByTable/${e}`,t||{}),d=e=>i().get("/modeling/dataflow/list",{params:e}),u=e=>i().post("/modeling/dataflow/add",e||{}),c=e=>i()["delete"](`/modeling/dataflow/delete/${e}`),g=e=>i().put("/modeling/dataflow/edit",e||{}),f=e=>i().get(`/modeling/dataflow/getById/${e}`),p=(e,t)=>i().get(`/modeling/dataflow/dataSourceDb/getSchemaByClusterNodeId/${e}/${t}`,e||{}),m=e=>i().post("/modeling/dataflow/getSql",e||{}),h=e=>i().post("/modeling/dataflow/runSql",e||{});let b=!0;const w=(e,t,a)=>new Promise((o=>{b&&(b=!1,i().put("/modeling/dataflow/edit",{id:e,operatorContent:JSON.stringify(t)}).then((e=>{o(!0),b=!0,200===Number(e.code)&&(a||n.Z.success({content:l.Z.global.t("modeling.dy_common.saveSuccess")}))})).catch((()=>{o(!1),a||n.Z.error({content:l.Z.global.t("modeling.dy_common.saveFailed")}),b=!0})))})),y=e=>i().get("/modeling/dataflow/dataSourceDb/list",e||{}),v=e=>i().post("/modeling/dataflow/getResultFieldsByOperator",e||{}),D=e=>i().post("/modeling/dataflow/visualization/params/add",e||{}),S=e=>i().put("/modeling/dataflow/visualization/params/edit",e||{}),$=e=>i()["delete"](`/modeling/dataflow/visualization/params/delete/${e}`),I=e=>i().post("/modeling/dataflow/visualization/params/generateChart",e||{}),z=(e,t)=>i().get(`/modeling/dataflow/visualization/params/getListByOperatorId/${e}`,t||{}),B=e=>i().post("/modeling/dataflow/visualization/snapshot/add",e||{}),k=(e,t)=>i().get(`/modeling/dataflow/visualization/snapshot/getListByDataFlowId/${e}`,t||{}),C=e=>i()["delete"](`/modeling/dataflow/visualization/snapshot/delete/${e}`),T=(e,t)=>i().get(`/modeling/dataflow/visualization/report/getListByDataFlowId/${e}`,{params:t||{}}),x=e=>i().post("/modeling/dataflow/visualization/report/add",e||{}),_=e=>i().put("/modeling/dataflow/visualization/report/update",e||{}),N=e=>i()["delete"](`/modeling/dataflow/visualization/report/delete/${e}`),Z=e=>i().get(`/modeling/dataflow/visualization/report/share/getByReportId/${e}`),P=(e,t)=>i().get(`/modeling/dataflow/visualization/customDimension/getListByOperatorId/${e}`,{params:t||{}}),E=e=>i().post("/modeling/dataflow/visualization/customDimension/add",e||{}),F=e=>i().put("/modeling/dataflow/visualization/customDimension/edit",e||{}),O=e=>i()["delete"](`/modeling/dataflow/visualization/customDimension/delete/${e}`),A=(e,t)=>i().get(`/modeling/visualization/report/share/getMapGeo/${e}`,t||{}),J=e=>i().post("/modeling/dataflow/visualization/params/uploadGeo",e||{}),R=(e,t)=>i().get(`/modeling/dataflow/visualization/params/getGeo/${e}`,{params:t||{}}),j=e=>i()["delete"](`/modeling/dataflow/visualization/params/deleteGeo/${e}`)},8603:function(e,t,a){a.d(t,{M:function(){return r}});a(57658);var n=a(89965),o=a(95684),i=a(15784);const l={graph:null,dataFlowInfo:{},rawData:{},useData:{},useDatabase:"",useTable:[]},r=(0,o.Q_)("dataFlow",{state(){return JSON.parse(JSON.stringify(l))},getters:{getTableSelectList:e=>e.useDatabase?e.useData[e.useDatabase]:[],getFieldsSelectList:e=>{if(e.useDatabase&&e.useTable.length>0){const t=e.useData[e.useDatabase],a=[];return e.useTable.forEach((e=>{const n={group:e,fields:[]},o=t.findIndex((t=>t.tablename===e));-1!==o&&(n.fields=t[o].fields),a.push(n)})),a}return[]},getFlowDataInfo:e=>e.dataFlowInfo,getFieldsByTable:e=>t=>{if(e.useDatabase){const a=e.useData[e.useDatabase];if(0===t||"0"===t){const t=a.findIndex((t=>t.tablename===e.useTable[0]));return-1===t?[]:a[t].fields}{const e=a.findIndex((e=>e.tablename===t));return-1===e?[]:a[e].fields}}return[]},getUseTable:e=>e.useTable,getUseDatabase:e=>e.useDatabase},actions:{setGraph(e){this.$patch((t=>{t.graph=e}))},initState(){return new Promise((e=>{this.$patch((t=>{t.useData=[],t.useDatabase="",t.useTable=[],t.rawData=[],t.dataFlowInfo=[],e(!0)}))}))},clearUse(){return new Promise((e=>{this.$patch((t=>{t.useDatabase="",t.useTable=[],e(!0)}))}))},setFlowDataInfo(e){this.$patch((t=>t.dataFlowInfo=e))},setDatabaseInfo(e,t,a){return new Promise(((o,l)=>{this.$patch((r=>{r.useDatabase=`${e}|,|${t}|,|${a}`,r.useTable=[],Object.keys(r.rawData).includes(`${e}|,|${t}|,|${a}`)?o(!0):(0,n.vs)(e,t,a).then((n=>{if(200===Number(n.code)){const i=n.data.map((e=>({...e,tables:{}})));r.rawData[`${e}|,|${t}|,|${a}`]=i,r.useData[`${e}|,|${t}|,|${a}`]=i,o(!0)}else i.Z.error("database not found"),l(!0)})).catch((()=>{i.Z.error("database not found"),l(!0)}))}))}))},setDatabaseTableInfo(e,t){return new Promise((a=>{this.$patch((o=>{if(e){t&&(t.tableKey||0===t.tableKey)?o.useTable[t.tableKey]=e:t&&t.noUse||o.useTable.push(e);const i=o.rawData[o.useDatabase].findIndex((t=>t.tablename===e));Object.keys(o.rawData[o.useDatabase][i].tables).includes(e)?a(!1):(0,n.yA)(`${o.useDatabase.split("|,|").join("/")}/${e}`).then((e=>{a(!0),o.rawData[o.useDatabase][i].fields=e.data,o.useData[o.useDatabase][i].fields=e.data}))}else a(!1)}))}))},removeDatabaseTable(e){return new Promise((t=>{this.$patch((a=>{const n=a.useTable.indexOf(e);-1!==n?(a.useTable.splice(n,1),t(!0)):t(!1)}))}))}}})},61362:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var n=a(47327),o=a(43610),i=a(8603),l=a(64253),r=a(28208);const s=(0,i.M)(),d=(0,o.m)(),u={attrs:{line:{stroke:"#222c36",strokeWidth:1,targetMarker:{name:"classic",size:8}}},zIndex:0,connector:{name:"rounded"},router:{name:"manhattan"}};class c{static init(e,t,a,n){return a&&a.offsetWidth&&a.offsetHeight,this.option.container=document.getElementById(e.containerId),this.option.connecting&&(this.option.connecting.validateEdge=({edge:e})=>(n&&n.edgeConnect&&n.edgeConnect(),(0,r.lineConnect)(this.graph.getCellById(e.source.cell),this.graph.getCellById(e.target.cell),this.graph))),this.graph=new l.kJ(e.canvasOption?{...this.option,...e.canvasOption}:this.option),this.initEvent(e,t,n),this.graph}static initEvent(e,t,a){const{graph:n}=this,o=document.getElementById(e.containerId),i=({cell:e})=>{const t=o.querySelectorAll(".x6-port-body");e.data&&e.data.disabled?this.togglePorts(t,!1):this.togglePorts(t,!0)};n.on("node:mouseenter",l.Iw.debounce((({node:e})=>{if(!e.data.portsDisabled){e.setData({showDisabledCheckbox:!0});const t=o.querySelectorAll(".x6-port-body");e.data.disabled||this.togglePorts(t,!0),e.on("change:data",i)}})),500),n.on("node:mouseleave",(({node:e})=>{if(!e.data.portsDisabled){e.setData({showDisabledCheckbox:!1});const t=o.querySelectorAll(".x6-port-body");this.togglePorts(t,!1),e.off("change:data",i)}})),n.on("node:collapse",(({node:e,e:t})=>{t.stopPropagation(),e.toggleCollapse();const a=e.isCollapsed(),n=e.getDescendants();n.forEach((e=>a?e.hide():e.show))})),n.on("cell:selected",(({cell:e})=>{e.setData({antvSelected:!0})})),n.on("cell:unselected",(({cell:e})=>{e.setData({antvSelected:!1})})),n.on("blank:click",(()=>{d.setSelectNode(null,!1)})),n.on("edge:mouseenter",(({edge:e})=>{(!e.data||!e.data.operate||e.data.operate&&Array.isArray(e.data.operate)&&e.data.operate.includes("showChangeArrow"))&&e.addTools(["source-arrowhead","target-arrowhead"])})),n.on("edge:mouseleave",(({edge:e})=>{(!e.data||!e.data.operate||e.data.operate&&Array.isArray(e.data.operate)&&e.data.operate.includes("showChangeArrow"))&&e.removeTools()})),n.bindKey("delete",(()=>{const e=n.getSelectedCells();if(e.length){const t=e.filter((e=>!e.data.operate||e.data.operate.includes("delete")));n.removeCells(t)}})),n.bindKey(["ctrl+s"],(()=>{const e=n.toJSON();e.cells.forEach((e=>{e.data&&e.data.cells_type?e.cells_type=e.data.cells_type:"edge"===e.shape&&(e.cells_type="line")}))})),n.on("cell:removed",(e=>{e.cell&&"join"===e.cell.cells_type&&s.removeDatabaseTable(e.cell.table),a&&a.deleteCell&&a.deleteCell()}))}static togglePorts(e,t){for(let a=0,n=e.length;a<n;a+=1)e[a].style.visibility=t?"visible":"hidden"}static createEdge(e,t,a){this.graph.addEdge({shape:"edge",source:e,target:t,...u,data:a||{}})}}(0,n.Z)(c,"graph",void 0),(0,n.Z)(c,"option",{width:1920,height:1080,autoResize:!0,background:{color:"#fff"},grid:{size:10,visible:!0,type:"doubleMesh",args:[{color:"#e3e3e3",thickness:1},{color:"#e3e3e3",thickness:1,factor:4}]},interacting:function(e){const t=e.cell.getData();return!t||!t.disableMove},scroller:{enabled:!0,pageVisible:!1,pageBreak:!0,pannable:!1},mousewheel:{enabled:!0,modifiers:["ctrl","meta"],minScale:.5,maxScale:2},selecting:{enabled:!0,multiple:!0,rubberband:!0,movable:!0},connecting:{anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,highlight:!0,snap:{radius:30},createEdge(){return new l.bn.kS(u)},validateConnection:({sourceView:e,targetView:t,sourceMagnet:a,targetMagnet:n})=>e!==t&&(!!a&&!!n)},highlighting:{magnetAvailable:{name:"stroke",args:{padding:4,attrs:{strokeWidth:4,stroke:"rgba(200,200,200)"}}}},snapline:!0,history:!0,clipboard:!0,keyboard:!0,embedding:{enabled:!0,findParent({node:e}){const t=e.getBBox();return this.getNodes().filter((e=>{const a=e.getData();if(a&&a.parent){const a=e.getBBox();return t.isIntersectWithRect(a)}return!1}))}}}),(0,n.Z)(c,"renderInitJson",(()=>{const e=s.getFlowDataInfo,t=JSON.parse(e.operatorContent);t&&t.cells&&t.cells.length>0&&(t.cells.forEach((e=>{e.cells_type in d.getRules&&"function"===typeof d.getRules[e.cells_type]&&(e.data.rule=d.getRules[e.cells_type])})),c.graph.fromJSON(t))})),(0,n.Z)(c,"createNode",((e,t,a,n)=>{if(t){let o=null;return e.stencil.nodes.forEach((e=>{e.child.forEach((e=>{e.data.configName===t&&(o=c.graph.createNode({shape:"BaseNode",x:(c.option.width?c.option.width:1920)/2+(a||0),y:(c.option.height?c.option.height/2:1080)/2+60+(n||0),width:220,height:60,ports:e.ports?e.ports:{},data:e.data?e.data:{}}))}))})),o&&c.graph.addNode(o),o}}))},28208:function(e,t,a){a.r(t),a.d(t,{lineConnect:function(){return l}});var n=a(15784),o=a(90989);const i=["query","update","delete","insert"],l=(e,t,a)=>{const l=e=>{n.Z.warning({content:e,duration:5e3})};if("dataSource"===t.data.cells_type)return l(o.Z.global.t("modeling.utils.index.5m835tc0m9o0")),!1;if("dataSource"===e.data.cells_type&&!i.includes(t.data.cells_type))return l(o.Z.global.t("modeling.utils.index.5m835tc0n8k0")),!1;if(i.includes(e.data.cells_type)&&i.includes(t.data.cells_type))return l(o.Z.global.t("modeling.utils.index.5m835tc0ndo0")),!1;const r=a.getEdges();if("dataSource"!==e.data.cells_type){const t=r.filter((t=>t.source.cell===e.id));if(t.length>1)return l(o.Z.global.t("modeling.utils.index.5m835tc0nh00")),!1}const s=r.filter((e=>e.target.cell===t.id));return!(s.length>1)||(l(o.Z.global.t("modeling.utils.index.5m835tc0njw0")),!1)}},47327:function(e,t,a){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){if("object"!==n(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function i(e){var t=o(e,"string");return"symbol"===n(t)?t:String(t)}function l(e,t,a){return t=i(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{Z:function(){return l}})}}]);
//# sourceMappingURL=1362.8a36dd61.js.map