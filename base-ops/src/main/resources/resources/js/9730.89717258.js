(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[9730,9383],{33781:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});var n=o(47327);class r{constructor(){(0,n.Z)(this,"heartTimeOut",void 0),(0,n.Z)(this,"ServerHeartTimeOut",void 0),(0,n.Z)(this,"timeout",5e3)}reset(){clearTimeout(this.heartTimeOut),clearTimeout(this.ServerHeartTimeOut)}start(e){this.heartTimeOut=setTimeout((t=>{e(t),this.ServerHeartTimeOut=setTimeout((t=>{e(t),this.reset(),this.start(e)}),this.timeout)}),this.timeout)}}class s extends r{constructor(e){super(),(0,n.Z)(this,"ws",void 0),(0,n.Z)(this,"reconnectTimer",0),(0,n.Z)(this,"reconnectCount",10),(0,n.Z)(this,"options",{url:null,heartTime:5e3,heartMsg:"ping",isReconnect:!0,isRestory:!1,reconnectTime:5e3,reconnectCount:5,openCb:e=>{console.log("connect success callback::::",e)},closeCb:e=>{console.log("close callback::::",e)},messageCb:e=>{console.log("message callback::::",e)},errorCb:e=>{console.log("error callback::::",e)}}),Object.assign(this.options,e),this.create()}create(){if(!("WebSocket"in window))throw new Error("The current browser does not support it and cannot be used");if(!this.options.url)throw new Error("The address does not exist, and the channel cannot be established");let e;console.log("get locaion host: ",window.location.host),e=`ws://${window.location.host}/ws/base-ops/${this.options.url}`,this.ws=new WebSocket(e),this.onopen(this.options.openCb),this.onclose(this.options.closeCb),this.onmessage(this.options.messageCb)}onopen(e){this.ws.onopen=t=>{"function"===typeof e?e(t):"function"===typeof this.options.openCb&&this.options.openCb(t)}}onclose(e){this.ws.onclose=t=>{"function"===typeof e?e(t):"function"===typeof this.options.closeCb&&this.options.closeCb(t)}}onerror(e){this.ws.onerror=t=>{"function"===typeof e?e(t):"function"===typeof this.options.errorCb&&this.options.errorCb(t)}}onmessage(e){this.ws.onmessage=t=>{const o=t.data;"function"===typeof e&&e(o)}}send(e){console.log("doNothing",e)}destroy(){super.reset(),clearTimeout(this.reconnectTimer),this.options.isRestory=!0,this.ws.close()}}},9383:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return l}});var n=o(70821),r=o(57330),s=o(79134),i=(0,n.defineComponent)({emits:["finish"],setup(e,{expose:t,emit:o}){const{t:i}=(0,r.QT)(),a=(0,n.reactive)({show:!1,title:i("customControl.HostPwdDlg.5mplfut5lgo0"),loading:!1,formData:{hostId:"",privateIp:"",publicIp:"",password:""},rules:{password:[{required:!0,"validate-trigger":"blur",message:i("customControl.HostPwdDlg.5mplfut5lus0")}]}}),l=(0,n.ref)(null),u=()=>{a.show=!1,(0,n.nextTick)((()=>{l.value?.clearValidate(),l.value?.resetFields()}))},c=()=>{l.value?.validate().then((async e=>{if(!e){const e=await(0,s.v)(a.formData.password);o("finish",{hostId:a.formData.hostId,password:e}),u()}}))},d=e=>{a.show=!0,a.title=i("customControl.HostPwdDlg.5mplfut5lgo0"),a.formData.hostId=e.hostId,a.formData.privateIp=e.privateIp,a.formData.publicIp=e.publicIp};return t({open:d}),(e,t)=>{const o=(0,n.resolveComponent)("a-form-item"),r=(0,n.resolveComponent)("a-input-password"),s=(0,n.resolveComponent)("a-form"),d=(0,n.resolveComponent)("a-modal");return(0,n.openBlock)(),(0,n.createBlock)(d,{"mask-closable":!1,"esc-to-close":!1,visible:(0,n.unref)(a).show,title:(0,n.unref)(a).title,"ok-loading":(0,n.unref)(a).loading,"modal-style":{width:"450px"},onOk:c,onCancel:u},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(s,{model:(0,n.unref)(a).formData,ref:(e,t)=>{t["formRef"]=e,l.value=e},"label-col":{style:{width:"100px"}},rules:(0,n.unref)(a).rules,"auto-label-width":""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(o,{label:e.$t("customControl.HostPwdDlg.5mplfut5bj80")},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)((0,n.unref)(a).formData.privateIp)+"("+(0,n.toDisplayString)((0,n.unref)(a).formData.publicIp)+") ",1)])),_:1},8,["label"]),(0,n.createVNode)(o,{field:"password",label:e.$t("customControl.HostPwdDlg.else1"),"validate-trigger":"blur",rules:[{required:!0,message:(0,n.unref)(i)("customControl.HostPwdDlg.5mplfut5lus0")}]},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{modelValue:(0,n.unref)(a).formData.password,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,n.unref)(a).formData.password=e),placeholder:e.$t("customControl.HostPwdDlg.5mplfut5kuc0"),"allow-clear":""},null,8,["modelValue","placeholder"])])),_:1},8,["label","rules"])])),_:1},8,["model","rules"])])),_:1},8,["visible","title","ok-loading"])}}});const a=i;var l=a},49730:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return y}});o(57658);var n=o(70821),r=o(33781),s=o(39518),i=o(98535),a=o(12320),l=o(12617),u=o(3334),c=o(9383);const d=e=>((0,n.pushScopeId)("data-v-23dc6c44"),e=e(),(0,n.popScopeId)(),e),p={class:"custom-control-container"},f={class:"flex-row mb"},h={class:"top-label mr-s"},m=(0,n.createTextVNode)("Connection establishment failure"),b=d((()=>(0,n.createElementVNode)("div",{id:"xterm",class:"xterm"},null,-1)));var v=(0,n.defineComponent)({setup(e){const t=(0,n.reactive)({loading:!1,hostId:"",rootPassword:"",hostListLoading:!1,hostList:[],hostObj:{},isSuccess:!0}),o=(0,n.ref)(),d=(0,n.ref)();(0,n.onMounted)((()=>{v()})),(0,n.onBeforeUnmount)((()=>{o.value?.destroy(),d.value&&d.value.dispose()}));const v=()=>{t.hostListLoading=!0,(0,s.zx)().then((e=>{200===Number(e.code)&&(t.hostList=[],e.data.forEach((e=>{t.hostObj[e.hostId]=e,t.hostList.push({label:`${e.privateIp}(${e.hostname})`,value:e.hostId})})),t.hostId=t.hostList[0].value,y(t.hostId))})).finally((()=>{t.hostListLoading=!1}))},w=()=>{t.hostId&&(o.value?.destroy(),d.value?.dispose(),y(t.hostId))},g=(0,n.ref)(null),y=e=>{t.hostObj[e]&&g.value?.open(t.hostObj[e])},_=e=>{t.hostId=e.hostId,t.rootPassword=e.password,C()},C=()=>{const e=k(),n=(new Date).getTime(),a=new r.Z({url:`custom_terminal_${n}`});o.value=a,a.onopen((()=>{const o={hostId:t.hostId,rootPassword:t.rootPassword,wsConnectType:i.Ie.SSH,businessId:`custom_terminal_${n}`};t.loading=!0,(0,s.Ye)(o).then((e=>{200!==Number(e.code)?(t.isSuccess=!1,a.destroy()):t.isSuccess=!0})).catch((()=>{t.isSuccess=!1,a.destroy()})).finally((()=>{t.loading=!1})),S(e,a.ws)}))},S=(e,t)=>{if(t){const o=new u.AttachAddon(t),n=new l.FitAddon;e.loadAddon(o),e.loadAddon(n),e.open(document.getElementById("xterm")),n.fit(),e.clear(),e.focus(),e.write("\r\n[33m$[0m "),d.value=e}},k=()=>new a.Terminal({fontSize:14,rows:40,cols:100,cursorBlink:!0,convertEol:!0,disableStdin:!1,cursorStyle:"underline",theme:{background:"black"}});return(e,o)=>{const r=(0,n.resolveComponent)("a-option"),s=(0,n.resolveComponent)("a-select"),i=(0,n.resolveComponent)("a-tag"),a=(0,n.resolveComponent)("a-spin");return(0,n.openBlock)(),(0,n.createElementBlock)("div",p,[(0,n.createElementVNode)("div",f,[(0,n.createElementVNode)("div",h,(0,n.toDisplayString)(e.$t("customControl.index.else1"))+":",1),(0,n.createVNode)(s,{class:"mr",style:{width:"300px"},loading:(0,n.unref)(t).hostListLoading,modelValue:(0,n.unref)(t).hostId,"onUpdate:modelValue":o[0]||(o[0]=e=>(0,n.unref)(t).hostId=e),placeholder:e.$t("customControl.index.5mplgrscm4s0"),onChange:w},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(t).hostList,((e,t)=>((0,n.openBlock)(),(0,n.createBlock)(r,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["loading","modelValue","placeholder"]),(0,n.createVNode)(a,{loading:(0,n.unref)(t).loading},{default:(0,n.withCtx)((()=>[(0,n.unref)(t).isSuccess||(0,n.unref)(t).loading?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createBlock)(i,{key:0,color:"red"},{default:(0,n.withCtx)((()=>[m])),_:1}))])),_:1},8,["loading"])]),b,(0,n.createVNode)(c["default"],{ref:(e,t)=>{t["hostPwdRef"]=e,g.value=e},onFinish:o[1]||(o[1]=e=>_(e))},null,512)])}}}),w=o(83744);const g=(0,w.Z)(v,[["__scopeId","data-v-23dc6c44"]]);var y=g},3334:function(e){!function(t,o){e.exports=o()}(window,(function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AttachAddon=void 0;var n=function(){function e(e,t){this._disposables=[],this._socket=e,this._socket.binaryType="arraybuffer",this._bidirectional=!t||!1!==t.bidirectional}return e.prototype.activate=function(e){var t=this;this._disposables.push(r(this._socket,"message",(function(t){var o=t.data;e.write("string"==typeof o?o:new Uint8Array(o))}))),this._bidirectional&&(this._disposables.push(e.onData((function(e){return t._sendData(e)}))),this._disposables.push(e.onBinary((function(e){return t._sendBinary(e)})))),this._disposables.push(r(this._socket,"close",(function(){return t.dispose()}))),this._disposables.push(r(this._socket,"error",(function(){return t.dispose()})))},e.prototype.dispose=function(){this._disposables.forEach((function(e){return e.dispose()}))},e.prototype._sendData=function(e){1===this._socket.readyState&&this._socket.send(e)},e.prototype._sendBinary=function(e){if(1===this._socket.readyState){for(var t=new Uint8Array(e.length),o=0;o<e.length;++o)t[o]=255&e.charCodeAt(o);this._socket.send(t)}},e}();function r(e,t,o){return e.addEventListener(t,o),{dispose:function(){o&&e.removeEventListener(t,o)}}}t.AttachAddon=n}])}))},12617:function(e){!function(t,o){e.exports=o()}(self,(function(){return(()=>{"use strict";var e={775:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FitAddon=void 0;var o=function(){function e(){}return e.prototype.activate=function(e){this._terminal=e},e.prototype.dispose=function(){},e.prototype.fit=function(){var e=this.proposeDimensions();if(e&&this._terminal){var t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}},e.prototype.proposeDimensions=function(){if(this._terminal&&this._terminal.element&&this._terminal.element.parentElement){var e=this._terminal._core;if(0!==e._renderService.dimensions.actualCellWidth&&0!==e._renderService.dimensions.actualCellHeight){var t=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(t.getPropertyValue("height")),n=Math.max(0,parseInt(t.getPropertyValue("width"))),r=window.getComputedStyle(this._terminal.element),s=o-(parseInt(r.getPropertyValue("padding-top"))+parseInt(r.getPropertyValue("padding-bottom"))),i=n-(parseInt(r.getPropertyValue("padding-right"))+parseInt(r.getPropertyValue("padding-left")))-e.viewport.scrollBarWidth;return{cols:Math.max(2,Math.floor(i/e._renderService.dimensions.actualCellWidth)),rows:Math.max(1,Math.floor(s/e._renderService.dimensions.actualCellHeight))}}}},e}();t.FitAddon=o}},t={};return function o(n){if(t[n])return t[n].exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}(775)})()}))},47327:function(e,t,o){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){if("object"!==n(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!==n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function s(e){var t=r(e,"string");return"symbol"===n(t)?t:String(t)}function i(e,t,o){return t=s(t),t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o.d(t,{Z:function(){return i}})}}]);
//# sourceMappingURL=9730.89717258.js.map