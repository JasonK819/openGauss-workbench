(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[8322],{33781:function(e,t,o){"use strict";o.d(t,{Z:function(){return r}});var n=o(47327);class s{constructor(){(0,n.Z)(this,"heartTimeOut",void 0),(0,n.Z)(this,"ServerHeartTimeOut",void 0),(0,n.Z)(this,"timeout",5e3)}reset(){clearTimeout(this.heartTimeOut),clearTimeout(this.ServerHeartTimeOut)}start(e){this.heartTimeOut=setTimeout((t=>{e(t),this.ServerHeartTimeOut=setTimeout((t=>{e(t),this.reset(),this.start(e)}),this.timeout)}),this.timeout)}}class r extends s{constructor(e){super(),(0,n.Z)(this,"ws",void 0),(0,n.Z)(this,"reconnectTimer",0),(0,n.Z)(this,"reconnectCount",10),(0,n.Z)(this,"options",{url:null,heartTime:5e3,heartMsg:"ping",isReconnect:!0,isRestory:!1,reconnectTime:5e3,reconnectCount:5,openCb:e=>{console.log("connect success callback::::",e)},closeCb:e=>{console.log("close callback::::",e)},messageCb:e=>{console.log("message callback::::",e)},errorCb:e=>{console.log("error callback::::",e)}}),Object.assign(this.options,e),this.create()}create(){if(!("WebSocket"in window))throw new Error("The current browser does not support it and cannot be used");if(!this.options.url)throw new Error("The address does not exist, and the channel cannot be established");let e;console.log("get locaion host: ",window.location.host),e=`ws://${window.location.host}/ws/base-ops/${this.options.url}`,this.ws=new WebSocket(e),this.onopen(this.options.openCb),this.onclose(this.options.closeCb),this.onmessage(this.options.messageCb)}onopen(e){this.ws.onopen=t=>{"function"===typeof e?e(t):"function"===typeof this.options.openCb&&this.options.openCb(t)}}onclose(e){this.ws.onclose=t=>{"function"===typeof e?e(t):"function"===typeof this.options.closeCb&&this.options.closeCb(t)}}onerror(e){this.ws.onerror=t=>{"function"===typeof e?e(t):"function"===typeof this.options.errorCb&&this.options.errorCb(t)}}onmessage(e){this.ws.onmessage=t=>{const o=t.data;"function"===typeof e&&e(o)}}send(e){console.log("doNothing",e)}destroy(){super.reset(),clearTimeout(this.reconnectTimer),this.options.isRestory=!0,this.ws.close()}}},38322:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return A}});o(57658);var n=o(70821),s=o(12320),r=o(12617),i=o(3334),l=o(39518),a=o(98535),c=o(40225),u=o(33781),p=o(79134);const d=e=>((0,n.pushScopeId)("data-v-fe1fa6c6"),e=e(),(0,n.popScopeId)(),e),m={class:"exe-install-c"},f={key:0,class:"flex-col full-w full-h"},h={class:"mb-lg"},v={class:"install-connect-c flex-col mb-xlg"},y={class:"ft-b mb"},b={class:"mb"},g=d((()=>(0,n.createElementVNode)("span",{class:"content"},"gaussdb",-1))),w={class:"content"},_={class:"flex-row"},S={key:1,class:"flex-row full-w teminal-h"},x={class:"panel-w flex-col-start mr"},C=d((()=>(0,n.createElementVNode)("div",{id:"xtermLog",class:"xterm"},null,-1))),k={key:0,class:"panel-w flex-col-start"},E={class:"full-w flex-between mb"},I=d((()=>(0,n.createElementVNode)("div",{id:"xterm",class:"xterm"},null,-1)));var N;(function(e){e[e["UN_INSTALL"]=Number(-1)]="UN_INSTALL",e[e["SUCESS"]=Number(1)]="SUCESS",e[e["FAIL"]=Number(0)]="FAIL"})(N||(N={}));var T=(0,n.defineComponent)({setup(e,{expose:t}){const o=(0,c.BH)(),d=(0,n.ref)(""),T=(0,n.ref)([]),V=(0,n.ref)({}),B=(0,n.ref)(""),A=(0,n.ref)(N.UN_INSTALL),L=(0,n.ref)(),O=(0,n.ref)(),P=(0,n.ref)(),D=(0,n.ref)(),$=(0,n.inject)("loading");(0,n.onMounted)((()=>{$.setNextBtnShow(!1),T.value=[],Object.keys(o.getMiniConfig).length&&(B.value=o.getMiniConfig.databasePassword,o.getMiniConfig.nodeConfigList.forEach((e=>{V.value[e.hostId]=e,T.value.push({hostId:e.hostId,privateIp:e.privateIp+"("+e.publicIp+")"})})),d.value=T.value[0].hostId),Z()})),(0,n.onBeforeUnmount)((()=>{L.value?.destroy(),O.value?.destroy(),P.value?.dispose(),D.value?.dispose()}));const j=()=>{O.value&&O.value?.destroy(),P.value&&P.value.dispose(),Z()},M=()=>new s.Terminal({fontSize:14,rows:40,cols:100,cursorBlink:!0,convertEol:!0,disableStdin:!1,cursorStyle:"underline",theme:{background:"black"}}),U=()=>{const e=M(),t=(new Date).getTime(),o=new u.Z({url:`terminal_${t}`});O.value=o,o.onopen((()=>{const n={hostId:d.value,rootPassword:"",wsConnectType:a.Ie.SSH,businessId:`terminal_${t}`};V.value[d.value]&&(0,p.v)(V.value[d.value].rootPassword).then((t=>{n.rootPassword=t,(0,l.Ye)(n),H(e,o.ws)})).catch((()=>{console.warn("encrypt error")}))}))},Z=()=>{const e=M(),t=(new Date).getTime(),o=new u.Z({url:`installLog_${t}`});L.value=o,o.onopen((async()=>{$.toLoading();const n=JSON.parse(JSON.stringify(z.value)),s=n.installContext.minimalistInstallConfig.nodeConfigList;for(let e=0;e<s.length;e++){const t=s[e],o=await(0,p.v)(t.rootPassword);t.rootPassword=o}n.businessId=`installLog_${t}`,(0,l.Ac)(n).then((t=>{200!==Number(t.code)&&(e.writeln(t.msg),o.destroy())})).catch((t=>{e.writeln(t.toString()),$.cancelLoading(),o.destroy()})),F(e,o.ws)})),o.onmessage((t=>{if(e.writeln(t),t.indexOf("FINAL_EXECUTE_EXIT_CODE")>-1){const e=Number(t.split(":")[1]);0===e?($.setBackBtnShow(!1),$.setNextBtnShow(!1),A.value=N.SUCESS,P.value&&P.value?.dispose()):($.cancelLoading(),A.value=N.FAIL,D.value&&D.value.dispose(),U()),o.destroy()}}))},F=(e,t)=>{if(t){const t=new r.FitAddon;e.loadAddon(t),e.open(document.getElementById("xtermLog")),t.fit(),e.clear(),e.focus(),P.value=e}},H=(e,t)=>{if(t){const o=new i.AttachAddon(t),n=new r.FitAddon;e.loadAddon(o),e.loadAddon(n),e.open(document.getElementById("xterm")),n.fit(),e.clear(),e.focus(),e.write("\r\n[33m$[0m "),D.value=e}},W=()=>{window.$wujie?.props.methods.jump({name:"Dashboard"})},q=async()=>!0,z=(0,n.computed)((()=>o.getInstallParam));return t({beforeConfirm:q}),(e,t)=>{const o=(0,n.resolveComponent)("svg-icon"),s=(0,n.resolveComponent)("a-button"),r=(0,n.resolveComponent)("a-alert"),i=(0,n.resolveComponent)("a-option"),l=(0,n.resolveComponent)("a-select");return(0,n.openBlock)(),(0,n.createElementBlock)("div",m,[A.value===N.SUCESS?((0,n.openBlock)(),(0,n.createElementBlock)("div",f,[(0,n.createVNode)(o,{"icon-class":"ops-install-success",class:"icon-size mb"}),(0,n.createElementVNode)("div",h,(0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16nuo0")),1),(0,n.createElementVNode)("div",v,[(0,n.createElementVNode)("div",y,(0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16oy40")),1),(0,n.createElementVNode)("div",b,[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16pb40"))+": ",1),g]),(0,n.createElementVNode)("div",null,[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16pig0"))+": ",1),(0,n.createElementVNode)("span",w,(0,n.toDisplayString)(B.value),1)])]),(0,n.createElementVNode)("div",_,[(0,n.createVNode)(s,{type:"outline",class:"mr",onClick:W},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16pp80")),1)])),_:1}),(0,n.createVNode)(s,{type:"primary",onClick:t[0]||(t[0]=t=>e.$router.push({name:"DailyOps"}))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16pxs0")),1)])),_:1})])])):((0,n.openBlock)(),(0,n.createElementBlock)("div",S,[(0,n.createElementVNode)("div",x,[A.value===N.FAIL?((0,n.openBlock)(),(0,n.createBlock)(r,{key:0,class:"mb",style:{padding:"14px 12px",width:"fit-content"},type:"error"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16q5o0")),1)])),_:1})):(0,n.createCommentVNode)("",!0),A.value===N.UN_INSTALL?((0,n.openBlock)(),(0,n.createBlock)(r,{key:1,type:"warning",class:"mb",style:{padding:"14px 12px",width:"fit-content"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16qhc0"))+" "+(0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16qr80")),1)])),_:1})):(0,n.createCommentVNode)("",!0),C]),A.value===N.FAIL?((0,n.openBlock)(),(0,n.createElementBlock)("div",k,[(0,n.createElementVNode)("div",E,[(0,n.createVNode)(l,{style:{width:"300px"},modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e)},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(T.value,((e,t)=>((0,n.openBlock)(),(0,n.createBlock)(i,{key:t,value:e.hostId,label:e.privateIp},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),(0,n.createVNode)(s,{type:"primary",onClick:j},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("simple.ExeInstall.5mpmsp16qzc0")),1)])),_:1})]),I])):(0,n.createCommentVNode)("",!0)]))])}}}),V=o(83744);const B=(0,V.Z)(T,[["__scopeId","data-v-fe1fa6c6"]]);var A=B},3334:function(e){!function(t,o){e.exports=o()}(window,(function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AttachAddon=void 0;var n=function(){function e(e,t){this._disposables=[],this._socket=e,this._socket.binaryType="arraybuffer",this._bidirectional=!t||!1!==t.bidirectional}return e.prototype.activate=function(e){var t=this;this._disposables.push(s(this._socket,"message",(function(t){var o=t.data;e.write("string"==typeof o?o:new Uint8Array(o))}))),this._bidirectional&&(this._disposables.push(e.onData((function(e){return t._sendData(e)}))),this._disposables.push(e.onBinary((function(e){return t._sendBinary(e)})))),this._disposables.push(s(this._socket,"close",(function(){return t.dispose()}))),this._disposables.push(s(this._socket,"error",(function(){return t.dispose()})))},e.prototype.dispose=function(){this._disposables.forEach((function(e){return e.dispose()}))},e.prototype._sendData=function(e){1===this._socket.readyState&&this._socket.send(e)},e.prototype._sendBinary=function(e){if(1===this._socket.readyState){for(var t=new Uint8Array(e.length),o=0;o<e.length;++o)t[o]=255&e.charCodeAt(o);this._socket.send(t)}},e}();function s(e,t,o){return e.addEventListener(t,o),{dispose:function(){o&&e.removeEventListener(t,o)}}}t.AttachAddon=n}])}))},12617:function(e){!function(t,o){e.exports=o()}(self,(function(){return(()=>{"use strict";var e={775:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FitAddon=void 0;var o=function(){function e(){}return e.prototype.activate=function(e){this._terminal=e},e.prototype.dispose=function(){},e.prototype.fit=function(){var e=this.proposeDimensions();if(e&&this._terminal){var t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}},e.prototype.proposeDimensions=function(){if(this._terminal&&this._terminal.element&&this._terminal.element.parentElement){var e=this._terminal._core;if(0!==e._renderService.dimensions.actualCellWidth&&0!==e._renderService.dimensions.actualCellHeight){var t=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(t.getPropertyValue("height")),n=Math.max(0,parseInt(t.getPropertyValue("width"))),s=window.getComputedStyle(this._terminal.element),r=o-(parseInt(s.getPropertyValue("padding-top"))+parseInt(s.getPropertyValue("padding-bottom"))),i=n-(parseInt(s.getPropertyValue("padding-right"))+parseInt(s.getPropertyValue("padding-left")))-e.viewport.scrollBarWidth;return{cols:Math.max(2,Math.floor(i/e._renderService.dimensions.actualCellWidth)),rows:Math.max(1,Math.floor(r/e._renderService.dimensions.actualCellHeight))}}}},e}();t.FitAddon=o}},t={};return function o(n){if(t[n])return t[n].exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}(775)})()}))},47327:function(e,t,o){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function s(e,t){if("object"!==n(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var s=o.call(e,t||"default");if("object"!==n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function r(e){var t=s(e,"string");return"symbol"===n(t)?t:String(t)}function i(e,t,o){return t=r(t),t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o.d(t,{Z:function(){return i}})}}]);
//# sourceMappingURL=8322.866bd533.js.map