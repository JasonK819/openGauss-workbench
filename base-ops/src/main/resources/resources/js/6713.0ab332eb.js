"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[6713,733],{89965:function(e,t,a){a.d(t,{AH:function(){return b},Bd:function(){return p},C7:function(){return _},DG:function(){return J},Du:function(){return z},H7:function(){return E},Iz:function(){return O},J6:function(){return F},Jh:function(){return g},NQ:function(){return q},QS:function(){return k},Qt:function(){return S},R7:function(){return x},Rq:function(){return c},SB:function(){return m},SW:function(){return y},UL:function(){return f},Up:function(){return w},WK:function(){return D},Yn:function(){return I},gp:function(){return d},j9:function(){return U},nB:function(){return C},qR:function(){return V},qo:function(){return v},sZ:function(){return B},v$:function(){return u},vs:function(){return i},w0:function(){return K},wB:function(){return T},x9:function(){return L},xl:function(){return N},yA:function(){return s},yf:function(){return $}});var n=a(15784),o=a(9669),l=a.n(o),r=a(90989);const i=(e,t,a,n)=>l().get(`/modeling/dataflow/dataSourceDb/getTablesBySchema/${e}/${t}/${a}`,n||{}),s=(e,t)=>l().get(`/modeling/dataflow/dataSourceDb/getFieldsByTable/${e}`,t||{}),d=e=>l().get("/modeling/dataflow/list",{params:e}),u=e=>l().post("/modeling/dataflow/add",e||{}),c=e=>l()["delete"](`/modeling/dataflow/delete/${e}`),f=e=>l().put("/modeling/dataflow/edit",e||{}),p=e=>l().get(`/modeling/dataflow/getById/${e}`),m=(e,t)=>l().get(`/modeling/dataflow/dataSourceDb/getSchemaByClusterNodeId/${e}/${t}`,e||{}),b=e=>l().post("/modeling/dataflow/getSql",e||{}),g=e=>l().post("/modeling/dataflow/runSql",e||{});let h=!0;const w=(e,t,a)=>new Promise((o=>{h&&(h=!1,l().put("/modeling/dataflow/edit",{id:e,operatorContent:JSON.stringify(t)}).then((e=>{o(!0),h=!0,200===Number(e.code)&&(a||n.Z.success({content:r.Z.global.t("modeling.dy_common.saveSuccess")}))})).catch((()=>{o(!1),a||n.Z.error({content:r.Z.global.t("modeling.dy_common.saveFailed")}),h=!0})))})),v=e=>l().get("/modeling/dataflow/dataSourceDb/list",e||{}),D=e=>l().post("/modeling/dataflow/getResultFieldsByOperator",e||{}),y=e=>l().post("/modeling/dataflow/visualization/params/add",e||{}),$=e=>l().put("/modeling/dataflow/visualization/params/edit",e||{}),x=e=>l()["delete"](`/modeling/dataflow/visualization/params/delete/${e}`),N=e=>l().post("/modeling/dataflow/visualization/params/generateChart",e||{}),C=(e,t)=>l().get(`/modeling/dataflow/visualization/params/getListByOperatorId/${e}`,t||{}),V=e=>l().post("/modeling/dataflow/visualization/snapshot/add",e||{}),k=(e,t)=>l().get(`/modeling/dataflow/visualization/snapshot/getListByDataFlowId/${e}`,t||{}),S=e=>l()["delete"](`/modeling/dataflow/visualization/snapshot/delete/${e}`),B=(e,t)=>l().get(`/modeling/dataflow/visualization/report/getListByDataFlowId/${e}`,{params:t||{}}),T=e=>l().post("/modeling/dataflow/visualization/report/add",e||{}),_=e=>l().put("/modeling/dataflow/visualization/report/update",e||{}),O=e=>l()["delete"](`/modeling/dataflow/visualization/report/delete/${e}`),z=e=>l().get(`/modeling/dataflow/visualization/report/share/getByReportId/${e}`),I=(e,t)=>l().get(`/modeling/dataflow/visualization/customDimension/getListByOperatorId/${e}`,{params:t||{}}),F=e=>l().post("/modeling/dataflow/visualization/customDimension/add",e||{}),q=e=>l().put("/modeling/dataflow/visualization/customDimension/edit",e||{}),E=e=>l()["delete"](`/modeling/dataflow/visualization/customDimension/delete/${e}`),L=(e,t)=>l().get(`/modeling/visualization/report/share/getMapGeo/${e}`,t||{}),J=e=>l().post("/modeling/dataflow/visualization/params/uploadGeo",e||{}),K=(e,t)=>l().get(`/modeling/dataflow/visualization/params/getGeo/${e}`,{params:t||{}}),U=e=>l()["delete"](`/modeling/dataflow/visualization/params/deleteGeo/${e}`)},8603:function(e,t,a){a.d(t,{M:function(){return i}});a(57658);var n=a(89965),o=a(95684),l=a(15784);const r={graph:null,dataFlowInfo:{},rawData:{},useData:{},useDatabase:"",useTable:[]},i=(0,o.Q_)("dataFlow",{state(){return JSON.parse(JSON.stringify(r))},getters:{getTableSelectList:e=>e.useDatabase?e.useData[e.useDatabase]:[],getFieldsSelectList:e=>{if(e.useDatabase&&e.useTable.length>0){const t=e.useData[e.useDatabase],a=[];return e.useTable.forEach((e=>{const n={group:e,fields:[]},o=t.findIndex((t=>t.tablename===e));-1!==o&&(n.fields=t[o].fields),a.push(n)})),a}return[]},getFlowDataInfo:e=>e.dataFlowInfo,getFieldsByTable:e=>t=>{if(e.useDatabase){const a=e.useData[e.useDatabase];if(0===t||"0"===t){const t=a.findIndex((t=>t.tablename===e.useTable[0]));return-1===t?[]:a[t].fields}{const e=a.findIndex((e=>e.tablename===t));return-1===e?[]:a[e].fields}}return[]},getUseTable:e=>e.useTable,getUseDatabase:e=>e.useDatabase},actions:{setGraph(e){this.$patch((t=>{t.graph=e}))},initState(){return new Promise((e=>{this.$patch((t=>{t.useData=[],t.useDatabase="",t.useTable=[],t.rawData=[],t.dataFlowInfo=[],e(!0)}))}))},clearUse(){return new Promise((e=>{this.$patch((t=>{t.useDatabase="",t.useTable=[],e(!0)}))}))},setFlowDataInfo(e){this.$patch((t=>t.dataFlowInfo=e))},setDatabaseInfo(e,t,a){return new Promise(((o,r)=>{this.$patch((i=>{i.useDatabase=`${e}|,|${t}|,|${a}`,i.useTable=[],Object.keys(i.rawData).includes(`${e}|,|${t}|,|${a}`)?o(!0):(0,n.vs)(e,t,a).then((n=>{if(200===Number(n.code)){const l=n.data.map((e=>({...e,tables:{}})));i.rawData[`${e}|,|${t}|,|${a}`]=l,i.useData[`${e}|,|${t}|,|${a}`]=l,o(!0)}else l.Z.error("database not found"),r(!0)})).catch((()=>{l.Z.error("database not found"),r(!0)}))}))}))},setDatabaseTableInfo(e,t){return new Promise((a=>{this.$patch((o=>{if(e){t&&(t.tableKey||0===t.tableKey)?o.useTable[t.tableKey]=e:t&&t.noUse||o.useTable.push(e);const l=o.rawData[o.useDatabase].findIndex((t=>t.tablename===e));Object.keys(o.rawData[o.useDatabase][l].tables).includes(e)?a(!1):(0,n.yA)(`${o.useDatabase.split("|,|").join("/")}/${e}`).then((e=>{a(!0),o.rawData[o.useDatabase][l].fields=e.data,o.useData[o.useDatabase][l].fields=e.data}))}else a(!1)}))}))},removeDatabaseTable(e){return new Promise((t=>{this.$patch((a=>{const n=a.useTable.indexOf(e);-1!==n?(a.useTable.splice(n,1),t(!0)):t(!1)}))}))}}})},733:function(e,t,a){a.r(t),a.d(t,{checkDisabled:function(){return n},saveData:function(){return o}});const n=(e,t,a)=>{if(!e||0===e.length)return!1;if("string"===typeof e[0]||"number"===typeof e[0])return-1!==e.indexOf(t);{const n=e;return-1!==n.findIndex((e=>e[a||"value"]===t))}},o=(e,t,a)=>{if(console.log(e,t,a),a){const n=a.getData();a?.setData({...n,[e]:JSON.parse(JSON.stringify(t))},{overwrite:!0})}}},63736:function(e,t,a){a.r(t),a.d(t,{default:function(){return s}});var n=a(70821),o=a(29067),l=(0,n.defineComponent)({props:{content:{type:String,required:!0},text:{type:String,required:!0},otherWidth:{type:Number,required:!1},fontSize:{type:Number,required:!1}},setup(e){const t=e,a=(0,n.ref)(),l=(0,n.ref)(!1),r=()=>{let e=a.value.parentNode.offsetWidth,n=a.value.offsetWidth+(t.otherWidth||0===t.otherWidth?t.otherWidth:24);l.value=!(n>e)};return(e,i)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(o.Z),{content:t.content,disabled:l.value},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("span",{onMouseover:r},[(0,n.renderSlot)(e.$slots,"default")],32),(0,n.createElementVNode)("span",{class:"get-width",ref:(e,t)=>{t["contentRef"]=e,a.value=e}},(0,n.toDisplayString)(t.text),513)])),_:3},8,["content","disabled"]))}}),r=a(83744);const i=(0,r.Z)(l,[["__scopeId","data-v-6f1614ab"]]);var s=i},96713:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});a(57658);var n=a(70821),o=a(8603),l=a(733),r=a(63736);const i={class:"tab-content d-a-form"},s={class:"select-comp-container"},d={class:"d-tips"},u=["onClick"],c={class:"warning"},f={class:"title"},p={class:"content"};var m=(0,n.defineComponent)({setup(e,{expose:t}){const a=(0,o.M)(),m=(0,n.computed)((()=>a.getUseTable));let b=null;const g=(0,n.reactive)({activeKey:"1"}),h=(0,n.reactive)({table:"",fields:[]}),w=(0,n.computed)((()=>a.getTableSelectList)),v=(0,n.computed)((()=>a.getFieldsSelectList)),D=e=>{b=e;let{data:t}=b;N.oldValue=t.table?t.table:"",h.table=t.table?t.table:"",h.fields=t.fields?t.fields:[]},y=(e,t)=>{b&&(0,l.saveData)(e,t,b)},$=(e,t)=>{"table"===t&&C()},x=(e,t)=>{"add-list"===e?h.fields.push(""):"delete-list"!==e||!t&&0!==t||h.fields.splice(t,1),y("fields",h.fields)},N=(0,n.reactive)({show:!1,loading:!1,oldValue:""}),C=()=>{N.oldValue?N.show=!0:k()},V=e=>{N.show=!1,e||(h.table=N.oldValue)},k=()=>{N.loading=!0,a.setDatabaseTableInfo(h.table,{tableKey:0}).then((()=>{N.loading=!1,N.oldValue=JSON.parse(JSON.stringify(h.table)),V(!0),y("table",h.table)})).catch((()=>{N.loading=!1,N.oldValue=JSON.parse(JSON.stringify(h.table)),V(!0),y("table",h.table)}))};return t({init:D}),(e,t)=>{const a=(0,n.resolveComponent)("a-option"),o=(0,n.resolveComponent)("a-select"),b=(0,n.resolveComponent)("a-form-item"),D=(0,n.resolveComponent)("a-col"),C=(0,n.resolveComponent)("icon-exclamation-circle-fill"),S=(0,n.resolveComponent)("a-row"),B=(0,n.resolveComponent)("a-optgroup"),T=(0,n.resolveComponent)("a-tab-pane"),_=(0,n.resolveComponent)("a-tabs"),O=(0,n.resolveComponent)("a-modal");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)(_,{class:"d-a-tabs",activeKey:(0,n.unref)(g).activeKey,"onUpdate:activeKey":t[3]||(t[3]=e=>(0,n.unref)(g).activeKey=e),centered:"",size:"mini",tabBarGutter:40,tabBarStyle:{color:"#fff"}},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(T,{key:"1",title:e.$t("modeling.base.DeleteOperator.5m7hqy836z40")},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",i,[(0,n.createVNode)(b,{label:e.$t("modeling.base.DeleteOperator.5m7hqy838600"),labelCol:{span:6,offset:0},labelAlign:"left",colon:!1},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",s,[(0,n.createVNode)(o,{"popup-container":".select-comp-container",modelValue:(0,n.unref)(h).table,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,n.unref)(h).table=e),placeholder:e.$t("modeling.base.DeleteOperator.5m7hqy838bg0"),allowSearch:"",onChange:t[1]||(t[1]=e=>$(e,"table"))},{label:(0,n.withCtx)((({data:e})=>[(0,n.createVNode)(r["default"],{text:e?.label,content:e?.label,"other-width":0},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e?.label),1)])),_:2},1032,["text","content"])])),default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(w),((e,t)=>((0,n.openBlock)(),(0,n.createBlock)(r["default"],{text:e.tablename,key:t,content:e.tablename},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(a,{value:e.tablename,disabled:(0,n.unref)(l.checkDisabled)((0,n.unref)(m),e.tablename)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.tablename),1)])),_:2},1032,["value","disabled"])])),_:2},1032,["text","content"])))),128))])),_:1},8,["modelValue","placeholder"])])])),_:1},8,["label"]),(0,n.createVNode)(S,null,{default:(0,n.withCtx)((()=>[(0,n.createVNode)(D,{span:3}),(0,n.createVNode)(D,{span:18},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",d,[(0,n.createVNode)(C),(0,n.createTextVNode)(" "+(0,n.toDisplayString)(e.$t("modeling.base.DeleteOperator.5maolasd5hk0")),1)])])),_:1})])),_:1}),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(h).fields,((i,s)=>((0,n.openBlock)(),(0,n.createBlock)(S,{class:"mb-s",key:`list2Row${s}`,align:"center"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(D,{span:22,class:"mr-xs"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(o,{modelValue:(0,n.unref)(h).fields[s],"onUpdate:modelValue":e=>(0,n.unref)(h).fields[s]=e,placeholder:e.$t("modeling.base.DeleteOperator.5m7hqy838hc0"),"trigger-props":{contentClass:"d-a-select-dropdown"},allowSearch:"",style:{width:"100%"},onChange:t[2]||(t[2]=e=>y("fields",(0,n.unref)(h).fields))},{label:(0,n.withCtx)((({data:e})=>[(0,n.createVNode)(r["default"],{text:e?.label,content:e?.label,"other-width":0},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e?.label),1)])),_:2},1032,["text","content"])])),default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(v),((e,t)=>((0,n.openBlock)(),(0,n.createBlock)(B,{key:`fieldsGroup${t}`,label:e.group},{label:(0,n.withCtx)((()=>[(0,n.createVNode)(r["default"],{text:e.group,content:e.group},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.group),1)])),_:2},1032,["text","content"])])),default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.fields,((t,o)=>((0,n.openBlock)(),(0,n.createBlock)(r["default"],{text:t.name,key:`field${o}`,content:`${e.group} . ${t.name}`},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(a,{value:`${e.group}.${t.name}`,disabled:(0,n.unref)(l.checkDisabled)((0,n.unref)(h).fields,`${e.group}.${t.name}`,"value")},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(t.name),1)])),_:2},1032,["value","disabled"])])),_:2},1032,["text","content"])))),128))])),_:2},1032,["label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024),(0,n.createVNode)(D,{span:1},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",{class:"d-control-remove",onClick:e=>x("delete-list",s)},"-",8,u)])),_:2},1024)])),_:2},1024)))),128))])])),_:1},8,["title"])])),_:1},8,["activeKey"]),(0,n.createVNode)(O,{visible:(0,n.unref)(N).show,"ok-loading":(0,n.unref)(N).loading,closable:!1,simple:"","ok-text":e.$t("modeling.base.DeleteOperator.5m7hqy838kw0"),"cancel-text":e.$t("modeling.base.DeleteOperator.5m7hqy838no0"),onOk:k,onCancel:V},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",c,[(0,n.createElementVNode)("div",f,[(0,n.createVNode)(C,{color:"#ff7d00"}),(0,n.createTextVNode)((0,n.toDisplayString)(e.$t("modeling.base.DeleteOperator.5m7hqy838q40")),1)]),(0,n.createElementVNode)("div",p,(0,n.toDisplayString)(e.$t("modeling.base.DeleteOperator.5m7hqy838t40")),1)])])),_:1},8,["visible","ok-loading","ok-text","cancel-text"])],64)}}}),b=a(83744);const g=(0,b.Z)(m,[["__scopeId","data-v-eedf745a"]]);var h=g}}]);
//# sourceMappingURL=6713.0ab332eb.js.map