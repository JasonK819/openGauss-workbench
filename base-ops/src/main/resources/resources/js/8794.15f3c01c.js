"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[8794],{89965:function(e,a,t){t.d(a,{AH:function(){return g},Bd:function(){return m},C7:function(){return B},DG:function(){return E},Du:function(){return k},H7:function(){return U},Iz:function(){return O},J6:function(){return _},Jh:function(){return b},NQ:function(){return J},QS:function(){return z},Qt:function(){return x},R7:function(){return I},Rq:function(){return c},SB:function(){return p},SW:function(){return $},UL:function(){return f},Up:function(){return w},WK:function(){return D},Yn:function(){return F},gp:function(){return u},j9:function(){return L},nB:function(){return y},qR:function(){return V},qo:function(){return v},sZ:function(){return C},v$:function(){return d},vs:function(){return r},w0:function(){return K},wB:function(){return T},x9:function(){return Z},xl:function(){return S},yA:function(){return i},yf:function(){return N}});var o=t(15784),n=t(9669),l=t.n(n),s=t(90989);const r=(e,a,t,o)=>l().get(`/modeling/dataflow/dataSourceDb/getTablesBySchema/${e}/${a}/${t}`,o||{}),i=(e,a)=>l().get(`/modeling/dataflow/dataSourceDb/getFieldsByTable/${e}`,a||{}),u=e=>l().get("/modeling/dataflow/list",{params:e}),d=e=>l().post("/modeling/dataflow/add",e||{}),c=e=>l()["delete"](`/modeling/dataflow/delete/${e}`),f=e=>l().put("/modeling/dataflow/edit",e||{}),m=e=>l().get(`/modeling/dataflow/getById/${e}`),p=(e,a)=>l().get(`/modeling/dataflow/dataSourceDb/getSchemaByClusterNodeId/${e}/${a}`,e||{}),g=e=>l().post("/modeling/dataflow/getSql",e||{}),b=e=>l().post("/modeling/dataflow/runSql",e||{});let h=!0;const w=(e,a,t)=>new Promise((n=>{h&&(h=!1,l().put("/modeling/dataflow/edit",{id:e,operatorContent:JSON.stringify(a)}).then((e=>{n(!0),h=!0,200===Number(e.code)&&(t||o.Z.success({content:s.Z.global.t("modeling.dy_common.saveSuccess")}))})).catch((()=>{n(!1),t||o.Z.error({content:s.Z.global.t("modeling.dy_common.saveFailed")}),h=!0})))})),v=e=>l().get("/modeling/dataflow/dataSourceDb/list",e||{}),D=e=>l().post("/modeling/dataflow/getResultFieldsByOperator",e||{}),$=e=>l().post("/modeling/dataflow/visualization/params/add",e||{}),N=e=>l().put("/modeling/dataflow/visualization/params/edit",e||{}),I=e=>l()["delete"](`/modeling/dataflow/visualization/params/delete/${e}`),S=e=>l().post("/modeling/dataflow/visualization/params/generateChart",e||{}),y=(e,a)=>l().get(`/modeling/dataflow/visualization/params/getListByOperatorId/${e}`,a||{}),V=e=>l().post("/modeling/dataflow/visualization/snapshot/add",e||{}),z=(e,a)=>l().get(`/modeling/dataflow/visualization/snapshot/getListByDataFlowId/${e}`,a||{}),x=e=>l()["delete"](`/modeling/dataflow/visualization/snapshot/delete/${e}`),C=(e,a)=>l().get(`/modeling/dataflow/visualization/report/getListByDataFlowId/${e}`,{params:a||{}}),T=e=>l().post("/modeling/dataflow/visualization/report/add",e||{}),B=e=>l().put("/modeling/dataflow/visualization/report/update",e||{}),O=e=>l()["delete"](`/modeling/dataflow/visualization/report/delete/${e}`),k=e=>l().get(`/modeling/dataflow/visualization/report/share/getByReportId/${e}`),F=(e,a)=>l().get(`/modeling/dataflow/visualization/customDimension/getListByOperatorId/${e}`,{params:a||{}}),_=e=>l().post("/modeling/dataflow/visualization/customDimension/add",e||{}),J=e=>l().put("/modeling/dataflow/visualization/customDimension/edit",e||{}),U=e=>l()["delete"](`/modeling/dataflow/visualization/customDimension/delete/${e}`),Z=(e,a)=>l().get(`/modeling/visualization/report/share/getMapGeo/${e}`,a||{}),E=e=>l().post("/modeling/dataflow/visualization/params/uploadGeo",e||{}),K=(e,a)=>l().get(`/modeling/dataflow/visualization/params/getGeo/${e}`,{params:a||{}}),L=e=>l()["delete"](`/modeling/dataflow/visualization/params/deleteGeo/${e}`)},8603:function(e,a,t){t.d(a,{M:function(){return r}});t(57658);var o=t(89965),n=t(95684),l=t(15784);const s={graph:null,dataFlowInfo:{},rawData:{},useData:{},useDatabase:"",useTable:[]},r=(0,n.Q_)("dataFlow",{state(){return JSON.parse(JSON.stringify(s))},getters:{getTableSelectList:e=>e.useDatabase?e.useData[e.useDatabase]:[],getFieldsSelectList:e=>{if(e.useDatabase&&e.useTable.length>0){const a=e.useData[e.useDatabase],t=[];return e.useTable.forEach((e=>{const o={group:e,fields:[]},n=a.findIndex((a=>a.tablename===e));-1!==n&&(o.fields=a[n].fields),t.push(o)})),t}return[]},getFlowDataInfo:e=>e.dataFlowInfo,getFieldsByTable:e=>a=>{if(e.useDatabase){const t=e.useData[e.useDatabase];if(0===a||"0"===a){const a=t.findIndex((a=>a.tablename===e.useTable[0]));return-1===a?[]:t[a].fields}{const e=t.findIndex((e=>e.tablename===a));return-1===e?[]:t[e].fields}}return[]},getUseTable:e=>e.useTable,getUseDatabase:e=>e.useDatabase},actions:{setGraph(e){this.$patch((a=>{a.graph=e}))},initState(){return new Promise((e=>{this.$patch((a=>{a.useData=[],a.useDatabase="",a.useTable=[],a.rawData=[],a.dataFlowInfo=[],e(!0)}))}))},clearUse(){return new Promise((e=>{this.$patch((a=>{a.useDatabase="",a.useTable=[],e(!0)}))}))},setFlowDataInfo(e){this.$patch((a=>a.dataFlowInfo=e))},setDatabaseInfo(e,a,t){return new Promise(((n,s)=>{this.$patch((r=>{r.useDatabase=`${e}|,|${a}|,|${t}`,r.useTable=[],Object.keys(r.rawData).includes(`${e}|,|${a}|,|${t}`)?n(!0):(0,o.vs)(e,a,t).then((o=>{if(200===Number(o.code)){const l=o.data.map((e=>({...e,tables:{}})));r.rawData[`${e}|,|${a}|,|${t}`]=l,r.useData[`${e}|,|${a}|,|${t}`]=l,n(!0)}else l.Z.error("database not found"),s(!0)})).catch((()=>{l.Z.error("database not found"),s(!0)}))}))}))},setDatabaseTableInfo(e,a){return new Promise((t=>{this.$patch((n=>{if(e){a&&(a.tableKey||0===a.tableKey)?n.useTable[a.tableKey]=e:a&&a.noUse||n.useTable.push(e);const l=n.rawData[n.useDatabase].findIndex((a=>a.tablename===e));Object.keys(n.rawData[n.useDatabase][l].tables).includes(e)?t(!1):(0,o.yA)(`${n.useDatabase.split("|,|").join("/")}/${e}`).then((e=>{t(!0),n.rawData[n.useDatabase][l].fields=e.data,n.useData[n.useDatabase][l].fields=e.data}))}else t(!1)}))}))},removeDatabaseTable(e){return new Promise((a=>{this.$patch((t=>{const o=t.useTable.indexOf(e);-1!==o?(t.useTable.splice(o,1),a(!0)):a(!1)}))}))}}})},78794:function(e,a,t){t.r(a),t.d(a,{default:function(){return h}});t(57658);var o=t(70821),n=t(73019),l=t(62e3),s=t(38655),r=t(8603),i=t(89965);const u={class:"tab-content d-a-form"},d={class:"d-tips"},c={class:"warning"},f={class:"title"},m={class:"content"};var p=(0,o.defineComponent)({setup(e,{expose:a}){const t=(0,r.M)(),p=(0,o.computed)((()=>t.getUseDatabase));let g=null;const b=e=>{g=e;let{data:a}=e;I.clusterId=a.clusterId?a.clusterId:"",I.clusterNodeId=a.clusterNodeId?a.clusterNodeId:"",I.schema=a.schema?a.schema:"",I.dbName=a.dbName?a.dbName:"",I.source=a.source?a.source:[],w.oldValue=a.source?a.source:""},h=(0,o.reactive)({activeKey:"1"}),w=(0,o.reactive)({show:!1,loading:!1,oldValue:""}),v=()=>w.show=!0,D=e=>{w.show=!1,e||(I.source=w.oldValue)},$=()=>{w.loading=!0,t.clearUse(),t.setDatabaseInfo(I.source[2],I.source[1],I.source[3]).then((()=>{w.loading=!1,w.oldValue=JSON.parse(JSON.stringify(I.source)),D(!0),S("source",I.source),S("clusterId",I.source[0]),S("clusterNodeId",I.source[1]),S("dbName",I.source[2]),S("schema",I.source[3])})).catch((()=>{t.clearUse(),w.loading=!1,I.source="",w.oldValue=JSON.parse(JSON.stringify(I.source)),D(!0),S("source",I.source),S("clusterId",I.source[0]),S("clusterNodeId",I.source[1]),S("dbName",I.source[2]),S("schema",I.source[3])}))},N=(e,a)=>{"source"===a&&(p.value===`${e[1]}|,|${e[2]}|,|${e[3]}`&&I.clusterId||e&&e.length>0&&v())},I=(0,o.reactive)({source:[],clusterId:"",clusterNodeId:"",schema:"",dbName:""}),S=(e,a)=>{if(g){let t=g.getData();g?.setData({...t,[e]:JSON.parse(JSON.stringify(a))},{overwrite:!0})}},y=(0,o.ref)([]),V=()=>{(0,i.qo)().then((e=>{e.data.forEach((e=>{e.value=e.clusterId,e.label=e.clusterId,e.clusterNodes&&e.clusterNodes.forEach((e=>{e.label=e.azName+"_"+e.publicIp,e.value=e.nodeId;let a=[];e.dbName=JSON.parse(e.dbName),e.dbName.forEach((t=>{a.push({label:t,value:t,parentId:e.nodeId})})),e.children=a})),e.children=e.clusterNodes})),y.value=e.data}))};V();const z=(e,a)=>{(0,i.SB)(e.value,e.parentId).then((e=>{200===Number(e.code)?a(e.data.map((e=>({label:e,value:e,isLeaf:!0})))):a()})).catch((()=>{a()}))},x=e=>{let a=[],t=y.value.findIndex((a=>a.value===e[0]));if(-1!==t){a.push(y.value[t].label);let o=y.value[t].children.findIndex((a=>a.value=e[1]));return-1===o?e.join(" / "):(a.push(y.value[t].children[o].label),a.push(e[2]),a.push(e[3]),a.join(" / "))}return e.join(" / ")};return a({init:b}),(e,a)=>{const t=(0,o.resolveComponent)("a-cascader"),r=(0,o.resolveComponent)("a-col"),i=(0,o.resolveComponent)("icon-exclamation-circle-fill"),p=(0,o.resolveComponent)("a-row"),g=(0,o.resolveComponent)("a-modal");return(0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,[(0,o.createVNode)((0,o.unref)(n.Z),{class:"d-a-tabs",activeKey:(0,o.unref)(h).activeKey,"onUpdate:activeKey":a[2]||(a[2]=e=>(0,o.unref)(h).activeKey=e),centered:"",size:"mini",tabBarGutter:40,tabBarStyle:{color:"#fff"}},{default:(0,o.withCtx)((()=>[(0,o.createVNode)((0,o.unref)(l.Z),{key:"1",title:e.$t("modeling.special.DataSource.5m7adso1d000")},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",u,[(0,o.createVNode)((0,o.unref)(s.Z),{label:e.$t("modeling.special.DataSource.5m7adso1dv00"),labelCol:{span:6,offset:0},labelAlign:"left",colon:!1},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(t,{"path-mode":"",modelValue:(0,o.unref)(I).source,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,o.unref)(I).source=e),options:y.value,placeholder:e.$t("modeling.special.DataSource.5m7adso1e040"),"load-more":z,fallback:x,onChange:a[1]||(a[1]=e=>N(e,"source"))},null,8,["modelValue","options","placeholder"])])),_:1},8,["label"]),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{span:3}),(0,o.createVNode)(r,{span:18},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",d,[(0,o.createVNode)(i),(0,o.createTextVNode)(" "+(0,o.toDisplayString)(e.$t("modeling.special.DataSource.5m7adso1e580")),1)])])),_:1})])),_:1})])])),_:1},8,["title"])])),_:1},8,["activeKey"]),(0,o.createVNode)(g,{visible:(0,o.unref)(w).show,"ok-loading":(0,o.unref)(w).loading,closable:!1,simple:"","ok-text":e.$t("modeling.special.DataSource.5m7adso1e7s0"),"cancel-text":e.$t("modeling.special.DataSource.5m7adso1eag0"),onOk:$,onCancel:D},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",c,[(0,o.createElementVNode)("div",f,[(0,o.createVNode)(i,{color:"#ff7d00"}),(0,o.createTextVNode)((0,o.toDisplayString)(e.$t("modeling.special.DataSource.5m7adso1eeo0")),1)]),(0,o.createElementVNode)("div",m,(0,o.toDisplayString)(e.$t("modeling.special.DataSource.5m7adso1ehg0")),1)])])),_:1},8,["visible","ok-loading","ok-text","cancel-text"])],64)}}}),g=t(83744);const b=(0,g.Z)(p,[["__scopeId","data-v-64dbdd72"]]);var h=b}}]);
//# sourceMappingURL=8794.15f3c01c.js.map