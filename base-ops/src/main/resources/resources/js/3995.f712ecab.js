"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[3995],{39518:function(e,t,a){a.d(t,{$4:function(){return y},Ac:function(){return i},BL:function(){return C},C4:function(){return T},DF:function(){return U},GD:function(){return P},IW:function(){return E},K4:function(){return L},Kf:function(){return A},LR:function(){return r},Lf:function(){return n},Ox:function(){return _},PK:function(){return u},R1:function(){return $},Sv:function(){return D},T2:function(){return c},T4:function(){return S},TL:function(){return k},TY:function(){return F},Uw:function(){return N},We:function(){return M},YQ:function(){return V},Ye:function(){return m},ZA:function(){return K},_V:function(){return f},c0:function(){return s},gi:function(){return q},h:function(){return b},jQ:function(){return Y},jV:function(){return R},nT:function(){return h},sT:function(){return w},tA:function(){return d},ur:function(){return I},w3:function(){return p},xj:function(){return g},y6:function(){return x},zs:function(){return B},zx:function(){return v}});var l=a(9669),o=a.n(l);const n=()=>o().get("encryption/getKey"),r=e=>o().post("opsCluster/download",e||{}),s=e=>o().get(`opsCluster/env/${e}`),i=e=>o().post("opsCluster/install",e),d=e=>o().post("opsCluster/import",e),u=e=>o().post("opsCluster/quickInstall",e),g=e=>o().get("opsCluster/check",{params:e}),p=e=>o().post("opsCluster/uninstall",e),c=e=>o().get("opsCluster/hasName",{params:e}),f=()=>o().get("opsCluster/listCluster"),m=e=>o().post("opsCluster/ssh",e),h=e=>o().get("opsCluster/monitor",{params:e}),C=e=>o().post("opsCluster/start",e),w=e=>o().post("opsCluster/stop",e),I=e=>o().post("opsCluster/restart",e),k=e=>o().get("opsCluster/listHost",{params:e}),b=e=>o().get(e?`opsCluster/listInstallPackage?path=${e}`:"opsCluster/listInstallPackage"),v=()=>o().get("host/listAll"),V=e=>o().get(`hostUser/listAllWithoutRoot/${e}`),y=()=>o().get("az/listAll"),U=e=>o().get("opsCluster/logPath",{params:e}),q=e=>o().get("opsCluster/ls",{params:e}),N=e=>o().get("opsCluster/slowSql",{params:e}),P=e=>o().get("opsCluster/auditLog",{params:e}),D=e=>o().get("opsCluster/download",{params:e}),x=e=>o().get("wdr/list",{params:e}),$=e=>o().post("wdr/generate",e),B=e=>o()["delete"]("wdr/del/"+e),_=e=>o().get("wdr/createSnapshot",{params:e}),L=e=>o().get("wdr/downloadWdr",{params:e}),T=e=>o().get("wdr/listSnapshot",{params:e}),E=e=>o().post("backup/backup",e),S=e=>o().get("backup/page",{params:e}),A=(e,t)=>o().post("backup/recover/"+e,t),R=e=>o()["delete"]("backup/del/"+e),M=e=>o().get("installPackageManager/page",{params:e}),F=e=>o()["delete"]("installPackageManager/"+e),K=e=>o().post("installPackageManager/save",e),Y=(e,t)=>o().put(`installPackageManager/update/${e}`,t)},63995:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});a(57658);var l=a(70821),o=a(98535),n=a(40225),r=a(39518),s=a(15784),i=a(57330);const d={class:"install-config-c"},u={class:"flex-col"},g={class:"flex-col-start"},p={class:"node-top full-w mb"},c={class:"flex-row"};var f=(0,l.defineComponent)({setup(e,{expose:t}){const{t:a}=(0,i.QT)(),f=(0,n.BH)(),m=(0,l.reactive)({nodeData:[],rules:{}}),h=(0,l.ref)(!1),C=(0,l.ref)([]),w=(0,l.ref)([]);(0,l.onMounted)((async()=>{if(I(),Object.keys(f.getLiteConfig).length&&f.getLiteConfig.nodeConfigList.length)await v(),f.getLiteConfig.nodeConfigList.forEach(((e,t)=>{m.nodeData.push(e),y(t)})),m.nodeData[0].port=f.getLiteConfig.port,m.nodeData[0].databasePassword=f.getLiteConfig.databasePassword;else{m.nodeData=[];const e=k();if(e.clusterRole=o._.MASTER,m.nodeData.push(e),P.value===o.K0.CLUSTER){const e=k();e.clusterRole=o._.SLAVE,m.nodeData.push(e)}v()}}));const I=()=>{m.rules={hostId:[{required:!0,"validate-trigger":"change",message:a("lightweight.InstallConfig.5mpmkfqybw00")}],installUserId:[{required:!0,"validate-trigger":"change",message:a("lightweight.InstallConfig.5mpmkfqy9yo0")}],clusterId:[{required:!0,"validate-trigger":"blur",message:a("lightweight.InstallConfig.5mpmkfqy8r00")},{validator:(e,t)=>new Promise((l=>{const o={name:e};(0,r.T2)(o).then((e=>{200===Number(e.code)?"Y"===e.data.has?(t(a("lightweight.InstallConfig.5mpmkfqyc0w0")),l(!1)):l(!0):(t(a("lightweight.InstallConfig.5mpmkfqyc5w0")),l(!1))}))}))}],port:[{required:!0,"validate-trigger":"blur",message:a("lightweight.InstallConfig.5mpmkfqyay80")}],rootPassword:[{required:!0,"validate-trigger":"blur",message:a("lightweight.InstallConfig.5mpmkfqy9h80")}],installPath:[{required:!0,"validate-trigger":"blur",message:a("lightweight.InstallConfig.5mpmkfqyaas0")}],dataPath:[{required:!0,"validate-trigger":"blur",message:a("lightweight.InstallConfig.5mpmkfqyan00")}],databaseUsername:[{required:!0,"validate-trigger":"blur",message:a("lightweight.InstallConfig.5mpmkfqyb9w0")}],databasePassword:[{required:!0,"validate-trigger":"blur",message:a("lightweight.InstallConfig.5mpmkfqybo00")}]}},k=()=>({clusterId:"",hostId:"",rootPassword:"",privateIp:"",publicIp:"",installUserId:"",installPath:"/opt/software/openGauss/install",dataPath:"/opt/software/openGauss/data",port:Number(5432),databaseUsername:"",databasePassword:""}),b=(0,l.ref)({}),v=()=>{h.value=!0,(0,r.zx)().then((e=>{200===Number(e.code)?(C.value=[],C.value=e.data,e.data.forEach((e=>{b.value[e.hostId]=e})),m.nodeData.length&&!m.nodeData[0].hostId&&(m.nodeData[0].hostId=C.value[0].hostId,m.nodeData[0].privateIp=C.value[0].privateIp,m.nodeData[0].publicIp=C.value[0].publicIp),y(0)):s.Z.error(a("lightweight.InstallConfig.5mpmkfqycac0"))})).finally((()=>{h.value=!1}))},V=(0,l.ref)({}),y=e=>{const t=m.nodeData[e].hostId;t&&(b.value[t]&&(m.nodeData[e].privateIp=b.value[t].privateIp,m.nodeData[e].publicIp=b.value[t].publicIp),V.value[t]&&!m.nodeData[e].installUserId?m.nodeData[e].installUserId=V.value[t][0].hostUserId:(0,r.YQ)(t).then((a=>{if(200===Number(a.code))if(a.data.length){V.value[t]=a.data;const l=m.nodeData[e].installUserId;if(l){const o=a.data.find((e=>e.hostUserId===l));o||(m.nodeData[e].installUserId=V.value[t][0].hostUserId)}else m.nodeData[e].installUserId=V.value[t][0].hostUserId}else m.nodeData[e].installUserId="";else s.Z.error("Description Failed to obtain user data from the host")})))},U=e=>{e&&w.value.push(e)},q=async()=>{let e=!0;for(let t=0;t<w.value.length;t++)if(w.value[t]){const a=await w.value[t].validate();a&&(e=!1)}if(e){const e=JSON.parse(JSON.stringify(m.nodeData));if(e.length){e.forEach((t=>{t.port=e[0].port})),f.setInstallContext({clusterId:e[0].clusterId});const t={clusterName:"",port:e[0].port,databaseUsername:e[0].databaseUsername,databasePassword:e[0].databasePassword,nodeConfigList:e};f.setLiteConfig(t)}return!0}return!1};t({beforeConfirm:q});const N=(0,l.computed)((()=>f.getInstallConfig.installType)),P=(0,l.computed)((()=>f.getInstallConfig.deployType));return(e,t)=>{const a=(0,l.resolveComponent)("a-tag"),o=(0,l.resolveComponent)("a-input"),n=(0,l.resolveComponent)("a-form-item"),r=(0,l.resolveComponent)("a-option"),s=(0,l.resolveComponent)("a-select"),i=(0,l.resolveComponent)("a-input-password"),f=(0,l.resolveComponent)("a-input-number"),w=(0,l.resolveComponent)("a-form");return(0,l.openBlock)(),(0,l.createElementBlock)("div",d,[(0,l.createElementVNode)("div",u,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(m).nodeData,((t,d)=>((0,l.openBlock)(),(0,l.createElementBlock)("div",{key:d},[(0,l.createElementVNode)("div",g,[(0,l.createElementVNode)("div",p,[(0,l.createElementVNode)("div",c,[(0,l.createVNode)(a,{class:"mr-s",color:"#86909C"},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(0===d?e.$t("lightweight.InstallConfig.5mpmkfqy71w0"):e.$t("lightweight.InstallConfig.5mpmkfqy8400")),1)])),_:2},1024),(0,l.createTextVNode)(" "+(0,l.toDisplayString)(e.$t("lightweight.InstallConfig.5mpmkfqy8es0")),1)])]),(0,l.createVNode)(w,{id:`formRef${d}`,model:t,rules:(0,l.unref)(m).rules,style:{width:"800px"},ref:e=>U(e)},{default:(0,l.withCtx)((()=>[0===d?((0,l.openBlock)(),(0,l.createBlock)(n,{key:0,field:"clusterId",label:e.$t("lightweight.InstallConfig.5mpmkfqy8nc0"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(o,{modelValue:t.clusterId,"onUpdate:modelValue":e=>t.clusterId=e,placeholder:e.$t("lightweight.InstallConfig.5mpmkfqy8r00")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"])):(0,l.createCommentVNode)("",!0),(0,l.createVNode)(n,{field:"hostId",label:e.$t("lightweight.InstallConfig.5mpmkfqy8vk0")},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(s,{loading:h.value,modelValue:t.hostId,"onUpdate:modelValue":e=>t.hostId=e,onChange:e=>y(d),placeholder:e.$t("lightweight.InstallConfig.5mpmkfqy91w0")},{default:(0,l.withCtx)((()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(C.value,(e=>((0,l.openBlock)(),(0,l.createBlock)(r,{key:e.hostId,value:e.hostId},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.publicIp+"("+(e.hostname?e.hostname:"--")+")"),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["loading","modelValue","onUpdate:modelValue","onChange","placeholder"])])),_:2},1032,["label"]),(0,l.createVNode)(n,{field:"rootPassword",label:e.$t("lightweight.InstallConfig.else1"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(i,{modelValue:t.rootPassword,"onUpdate:modelValue":e=>t.rootPassword=e,placeholder:e.$t("lightweight.InstallConfig.5mpmkfqy9h80"),"allow-clear":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"]),(0,l.createVNode)(n,{field:"installUserId",label:e.$t("lightweight.InstallConfig.5mpmkfqy9rw0")},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(s,{modelValue:t.installUserId,"onUpdate:modelValue":e=>t.installUserId=e,placeholder:e.$t("lightweight.InstallConfig.5mpmkfqy9yo0")},{default:(0,l.withCtx)((()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(V.value[t.hostId],(e=>((0,l.openBlock)(),(0,l.createBlock)(r,{key:e.hostUserId,value:e.hostUserId},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.username),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"]),(0,l.createVNode)(n,{field:"installPath",label:e.$t("lightweight.InstallConfig.5mpmkfqya4o0"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(o,{modelValue:t.installPath,"onUpdate:modelValue":e=>t.installPath=e,placeholder:e.$t("lightweight.InstallConfig.5mpmkfqyaas0")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"]),(0,l.createVNode)(n,{field:"dataPath",label:e.$t("lightweight.InstallConfig.5mpmkfqyah00"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(o,{modelValue:t.dataPath,"onUpdate:modelValue":e=>t.dataPath=e,placeholder:e.$t("lightweight.InstallConfig.5mpmkfqyan00")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"]),0===d?((0,l.openBlock)(),(0,l.createBlock)(n,{key:1,field:"port",label:e.$t("lightweight.InstallConfig.5mpmkfqyasw0"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(f,{modelValue:t.port,"onUpdate:modelValue":e=>t.port=e,placeholder:e.$t("lightweight.InstallConfig.5mpmkfqyay80")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"])):(0,l.createCommentVNode)("",!0),"import"===(0,l.unref)(N)&&0===d?((0,l.openBlock)(),(0,l.createBlock)(n,{key:2,field:"databaseUsername",label:e.$t("lightweight.InstallConfig.5mpmkfqyb4c0"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(i,{modelValue:t.databaseUsername,"onUpdate:modelValue":e=>t.databaseUsername=e,placeholder:e.$t("lightweight.InstallConfig.5mpmkfqyb9w0"),"allow-clear":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"])):(0,l.createCommentVNode)("",!0),0===d?((0,l.openBlock)(),(0,l.createBlock)(n,{key:3,field:"databasePassword",label:e.$t("lightweight.InstallConfig.5mpmkfqybf80"),"validate-trigger":"blur"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(i,{modelValue:t.databasePassword,"onUpdate:modelValue":e=>t.databasePassword=e,placeholder:e.$t("lightweight.InstallConfig.5mpmkfqybo00"),"allow-clear":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label"])):(0,l.createCommentVNode)("",!0)])),_:2},1032,["id","model","rules"])])])))),128))])])}}});const m=f;var h=m}}]);
//# sourceMappingURL=3995.f712ecab.js.map