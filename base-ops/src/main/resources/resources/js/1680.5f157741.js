"use strict";(self["webpackChunkweb_ui"]=self["webpackChunkweb_ui"]||[]).push([[1680],{81680:function(e,t,o){o.r(t),o.d(t,{default:function(){return y}});o(57658);var a=o(70821),n=o(15784),c=o(47191),l=o(12320),d=o(12617),i=o(3334),r=o(33781),s=o(39518),u=o(57330);const p={class:"upgrade-container",id:"backup"},m={class:"flex-row-end mb"},b={class:"flex-row mr"},g={class:"top-label mr-s"},k={class:"flex-row-start"};var x=(0,a.defineComponent)({setup(e){const{t:t}=(0,u.QT)(),o=(0,a.reactive)({clusterId:"",clusterListLoading:!1,clusterList:[]}),x=(0,a.computed)((()=>[{title:t("backup.index.5mpm2oya8lk0"),dataIndex:"clusterId"},{title:t("backup.index.5mpm2oya8r80"),dataIndex:"backupId"},{title:t("backup.index.5mpm2oya8uo0"),dataIndex:"hostId",slotName:"host"},{title:t("backup.index.5mpm2oya8y00"),dataIndex:"backupPath"},{title:t("backup.index.5mpm2oya9280"),dataIndex:"createTime"},{title:t("backup.index.5mpm2oya95o0"),slotName:"operation"}])),f=(0,a.reactive)({search:"",pageNum:1,pageSize:10}),w=(0,a.reactive)({data:[],page:{page:1,pageSize:10,total:0},loading:!1});(0,a.onMounted)((()=>{h(),y()}));const y=()=>new Promise((e=>{o.clusterListLoading=!0,(0,s._V)().then((t=>{200===Number(t.code)?(e(!0),t.data.forEach((e=>{o.clusterList.push({label:e.clusterId,value:e.clusterId})}))):e(!1)})).finally((()=>{o.clusterListLoading=!1}))})),h=()=>new Promise((e=>{w.loading=!0,(0,s.T4)(f).then((t=>{200===Number(t.code)?(e(!0),w.data=t.data.records,w.page.total=t.data.total):e(!1)})).finally((()=>{w.loading=!1}))})),I=e=>{f.pageNum=e,h()},v=e=>{w.loading=!0;const t=(new Date).getTime(),o=new r.Z({url:`backup_${e.backupId}_${t}`});o.onopen((()=>{const a={wsConnectType:"COMMAND_EXEC",businessId:`backup_${e.backupId}_${t}`};(0,s.Kf)(e.backupId,a).then((t=>{if(200!==Number(t.code))o.destroy();else{C(e.backupId),_(e);const t=E();V(t,o,e.backupId)}})).catch((()=>{w.loading=!1,console.log("catch destroy"),o.destroy()}))})),o.onmessage((e=>{console.log("onmessage destroy"),e.indexOf("FINAL_EXECUTE_EXIT_CODE")>-1&&(w.loading=!1,o.destroy())}))},N=e=>{w.loading=!0,(0,s.jV)(e.backupId).then((e=>{200===Number(e.code)?h():n.Z.error("delete backup fail")})).catch((()=>{n.Z.error("delete backup fail")})).finally((()=>{w.loading=!1}))},C=e=>{const t=document.createElement("div"),o=document.createAttribute("id");o.value=e,t.setAttributeNode(o);const a=document.createAttribute("class");a.value="xterm",t.setAttributeNode(a);const n=document.createAttribute("style");t.setAttributeNode(n),document.getElementById("backup")?.append(t)},E=()=>new l.Terminal({fontSize:14,rows:40,cols:100,cursorBlink:!0,convertEol:!0,disableStdin:!1,cursorStyle:"underline",theme:{background:"black"}}),V=(e,t,o)=>{if(t){console.log("initTerm created",o,document.getElementById(o));const a=new i.AttachAddon(t.ws),n=new d.FitAddon;e.loadAddon(a),e.loadAddon(n),e.open(document.getElementById(o)),n.fit(),e.clear(),e.focus(),e.write("\r\n[33m$[0m ")}},_=e=>{const t=(0,c.W)();t({id:e.backId,title:e.clusterId+" backup recover",mount:document.getElementById(e.backupId),class:["custom-winbox","no-full","no-max"],background:"#1D2129",x:"center",y:"center",onClose:function(){w.loading=!1,h()},onminimize:function(){const e=this.window?.getAttribute("class");if(e){const t=e.replace("custom-winbox","custom-winbox-mini");this.window?.setAttribute("class",t)}},onrestore:function(){const e=this.window?.getAttribute("class");if(e){const t=e.replace("custom-winbox-mini","custom-winbox");this.window?.setAttribute("class",t)}}})};return(e,t)=>{const n=(0,a.resolveComponent)("a-option"),c=(0,a.resolveComponent)("a-select"),l=(0,a.resolveComponent)("a-button"),d=(0,a.resolveComponent)("a-link"),i=(0,a.resolveComponent)("a-popconfirm"),r=(0,a.resolveComponent)("a-table");return(0,a.openBlock)(),(0,a.createElementBlock)("div",p,[(0,a.createElementVNode)("div",m,[(0,a.createElementVNode)("div",b,[(0,a.createElementVNode)("div",g,(0,a.toDisplayString)(e.$t("backup.index.else1"))+":",1),(0,a.createVNode)(c,{style:{width:"200px"},loading:(0,a.unref)(o).clusterListLoading,modelValue:(0,a.unref)(o).clusterId,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,a.unref)(o).clusterId=e),"allow-clear":"",placeholder:e.$t("backup.index.5mpm2oya7bg0")},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)((0,a.unref)(o).clusterList,((e,t)=>((0,a.openBlock)(),(0,a.createBlock)(n,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["loading","modelValue","placeholder"])]),(0,a.createVNode)(l,{type:"primary",onClick:h},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$t("backup.index.5mpm2oya7y80")),1)])),_:1})]),(0,a.createVNode)(r,{class:"d-a-table-row full-h",data:(0,a.unref)(w).data,columns:(0,a.unref)(x),pagination:(0,a.unref)(w).page,loading:(0,a.unref)(w).loading,onPageChange:I},{host:(0,a.withCtx)((({record:e})=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.privateIp)+"("+(0,a.toDisplayString)(e.publicIp)+") ",1)])),operation:(0,a.withCtx)((({record:t})=>[(0,a.createElementVNode)("div",k,[(0,a.createVNode)(d,{class:"mr",onClick:e=>v(t)},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$t("backup.index.5mpm2oya83s0")),1)])),_:2},1032,["onClick"]),(0,a.createVNode)(i,{content:e.$t("backup.index.5mpm2oya87g0"),type:"warning","ok-text":e.$t("backup.index.5mpm2oya8b00"),"cancel-text":e.$t("backup.index.5mpm2oya8ek0"),onOk:e=>N(t)},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{status:"danger"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$t("backup.index.5mpm2oya8i80")),1)])),_:1})])),_:2},1032,["content","ok-text","cancel-text","onOk"])])])),_:1},8,["data","columns","pagination","loading"])])}}}),f=o(83744);const w=(0,f.Z)(x,[["__scopeId","data-v-02c2e2b7"]]);var y=w}}]);
//# sourceMappingURL=1680.5f157741.js.map